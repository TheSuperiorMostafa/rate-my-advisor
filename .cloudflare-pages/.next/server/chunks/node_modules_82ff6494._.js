module.exports=[78742,27365,e=>{"use strict";var t,r,a,i,n,s,o=function(e,t,r,a,i){if("m"===a)throw TypeError("Private method is not writable");if("a"===a&&!i)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?i.call(e,r):i?i.value=r:t.set(e,r),r},c=function(e,t,r,a){if("a"===r&&!a)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(e):a?a.value:t.get(e)};function d(e){let t=e?"__Secure-":"";return{sessionToken:{name:`${t}authjs.session-token`,options:{httpOnly:!0,sameSite:"lax",path:"/",secure:e}},callbackUrl:{name:`${t}authjs.callback-url`,options:{httpOnly:!0,sameSite:"lax",path:"/",secure:e}},csrfToken:{name:`${e?"__Host-":""}authjs.csrf-token`,options:{httpOnly:!0,sameSite:"lax",path:"/",secure:e}},pkceCodeVerifier:{name:`${t}authjs.pkce.code_verifier`,options:{httpOnly:!0,sameSite:"lax",path:"/",secure:e,maxAge:900}},state:{name:`${t}authjs.state`,options:{httpOnly:!0,sameSite:"lax",path:"/",secure:e,maxAge:900}},nonce:{name:`${t}authjs.nonce`,options:{httpOnly:!0,sameSite:"lax",path:"/",secure:e}},webauthnChallenge:{name:`${t}authjs.challenge`,options:{httpOnly:!0,sameSite:"lax",path:"/",secure:e,maxAge:900}}}}class l{constructor(e,n,s){if(t.add(this),r.set(this,{}),a.set(this,void 0),i.set(this,void 0),o(this,i,s,"f"),o(this,a,e,"f"),!n)return;const{name:d}=e;for(const[e,t]of Object.entries(n))e.startsWith(d)&&t&&(c(this,r,"f")[e]=t)}get value(){return Object.keys(c(this,r,"f")).sort((e,t)=>parseInt(e.split(".").pop()||"0")-parseInt(t.split(".").pop()||"0")).map(e=>c(this,r,"f")[e]).join("")}chunk(e,r){let i=c(this,t,"m",s).call(this);for(let s of c(this,t,"m",n).call(this,{name:c(this,a,"f").name,value:e,options:{...c(this,a,"f").options,...r}}))i[s.name]=s;return Object.values(i)}clean(){return Object.values(c(this,t,"m",s).call(this))}}r=new WeakMap,a=new WeakMap,i=new WeakMap,t=new WeakSet,n=function(e){let t=Math.ceil(e.value.length/3936);if(1===t)return c(this,r,"f")[e.name]=e.value,[e];let a=[];for(let i=0;i<t;i++){let t=`${e.name}.${i}`,n=e.value.substr(3936*i,3936);a.push({...e,name:t,value:n}),c(this,r,"f")[t]=n}return c(this,i,"f").debug("CHUNKING_SESSION_COOKIE",{message:"Session cookie exceeds allowed 4096 bytes.",emptyCookieSize:160,valueSize:e.value.length,chunks:a.map(e=>e.value.length+160)}),a},s=function(){let e={};for(let t in c(this,r,"f"))delete c(this,r,"f")?.[t],e[t]={name:t,value:"",options:{...c(this,a,"f").options,maxAge:0}};return e},e.s(["SessionStore",()=>l,"defaultCookies",()=>d],78742);class p extends Error{constructor(e,t){e instanceof Error?super(void 0,{cause:{err:e,...e.cause,...t}}):"string"==typeof e?(t instanceof Error&&(t={err:t,...t.cause}),super(e,t)):super(void 0,e),this.name=this.constructor.name,this.type=this.constructor.type??"AuthError",this.kind=this.constructor.kind??"error",Error.captureStackTrace?.(this,this.constructor);const r=`https://errors.authjs.dev#${this.type.toLowerCase()}`;this.message+=`${this.message?". ":""}Read more at ${r}`}}class y extends p{}y.kind="signIn";class u extends p{}u.type="AdapterError";class h extends p{}h.type="AccessDenied";class f extends p{}f.type="CallbackRouteError";class w extends p{}w.type="ErrorPageLoop";class m extends p{}m.type="EventError";class A extends p{}A.type="InvalidCallbackUrl";class E extends y{constructor(){super(...arguments),this.code="credentials"}}E.type="CredentialsSignin";class g extends p{}g.type="InvalidEndpoints";class b extends p{}b.type="InvalidCheck";class S extends p{}S.type="JWTSessionError";class v extends p{}v.type="MissingAdapter";class k extends p{}k.type="MissingAdapterMethods";class C extends p{}C.type="MissingAuthorize";class K extends p{}K.type="MissingSecret";class H extends y{}H.type="OAuthAccountNotLinked";class P extends y{}P.type="OAuthCallbackError";class W extends p{}W.type="OAuthProfileParseError";class T extends p{}T.type="SessionTokenError";class x extends p{}x.type="SignOutError";class O extends p{}O.type="UnknownAction";class U extends p{}U.type="UnsupportedStrategy";class J extends p{}J.type="InvalidProvider";class I extends p{}I.type="UntrustedHost";class M extends p{}M.type="Verification";class R extends y{}R.type="MissingCSRF";let D=new Set(["CredentialsSignin","OAuthAccountNotLinked","OAuthCallbackError","AccessDenied","Verification","MissingCSRF","AccountNotLinked","WebAuthnVerificationError"]);function _(e){return e instanceof p&&D.has(e.type)}class j extends p{}j.type="DuplicateConditionalUI";class $ extends p{}$.type="MissingWebAuthnAutocomplete";class B extends p{}B.type="WebAuthnVerificationError";class N extends y{}N.type="AccountNotLinked";class L extends p{}L.type="ExperimentalFeatureNotEnabled",e.s(["AccessDenied",()=>h,"AccountNotLinked",()=>N,"AdapterError",()=>u,"AuthError",()=>p,"CallbackRouteError",()=>f,"CredentialsSignin",()=>E,"DuplicateConditionalUI",()=>j,"ErrorPageLoop",()=>w,"EventError",()=>m,"ExperimentalFeatureNotEnabled",()=>L,"InvalidCallbackUrl",()=>A,"InvalidCheck",()=>b,"InvalidEndpoints",()=>g,"InvalidProvider",()=>J,"JWTSessionError",()=>S,"MissingAdapter",()=>v,"MissingAdapterMethods",()=>k,"MissingAuthorize",()=>C,"MissingCSRF",()=>R,"MissingSecret",()=>K,"MissingWebAuthnAutocomplete",()=>$,"OAuthAccountNotLinked",()=>H,"OAuthCallbackError",()=>P,"OAuthProfileParseError",()=>W,"SessionTokenError",()=>T,"SignOutError",()=>x,"UnknownAction",()=>O,"UnsupportedStrategy",()=>U,"UntrustedHost",()=>I,"Verification",()=>M,"WebAuthnVerificationError",()=>B,"isClientError",()=>_],27365)},11445,32802,63370,65466,42020,13366,31582,12319,72448,e=>{"use strict";let t,r;var a=e.i(54799);"function"!=typeof a.hkdf||process.versions.electron||(t=async(...e)=>new Promise((t,r)=>{a.hkdf(...e,(e,a)=>{e?r(e):t(new Uint8Array(a))})}));let i=async(e,r,i,n,s)=>(t||((e,t,r,i,n)=>{let s=parseInt(e.substr(3),10)>>3||20,o=(0,a.createHmac)(e,r.byteLength?r:new Uint8Array(s)).update(t).digest(),c=Math.ceil(n/s),d=new Uint8Array(s*c+i.byteLength+1),l=0,p=0;for(let t=1;t<=c;t++)d.set(i,p),d[p+i.byteLength]=t,d.set((0,a.createHmac)(e,o).update(d.subarray(l,p+i.byteLength+1)).digest(),p),l=p,p+=s;return d.slice(0,n)}))(e,r,i,n,s);function n(e,t){if("string"==typeof e)return new TextEncoder().encode(e);if(!(e instanceof Uint8Array))throw TypeError(`"${t}"" must be an instance of Uint8Array or a string`);return e}async function s(e,t,r,a,s){return i(function(e){switch(e){case"sha256":case"sha384":case"sha512":case"sha1":return e;default:throw TypeError('unsupported "digest" value')}}(e),function(e){let t=n(e,"ikm");if(!t.byteLength)throw TypeError('"ikm" must be at least one byte in length');return t}(t),n(r,"salt"),function(e){let t=n(e,"info");if(t.byteLength>1024)throw TypeError('"info" must not contain more than 1024 bytes');return t}(a),function(e,t){if("number"!=typeof e||!Number.isInteger(e)||e<1)throw TypeError('"keylen" must be a positive integer');if(e>255*(parseInt(t.substr(3),10)>>3||20))throw TypeError('"keylen" too large');return e}(s,e))}e.s(["hkdf",()=>s],11445);let o=new TextEncoder,c=new TextDecoder;function d(...e){let t=new Uint8Array(e.reduce((e,{length:t})=>e+t,0)),r=0;for(let a of e)t.set(a,r),r+=a.length;return t}function l(e,t,r){if(t<0||t>=0x100000000)throw RangeError(`value must be >= 0 and <= ${0x100000000-1}. Received ${t}`);e.set([t>>>24,t>>>16,t>>>8,255&t],r)}function p(e){let t=Math.floor(e/0x100000000),r=new Uint8Array(8);return l(r,t,0),l(r,e%0x100000000,4),r}function y(e){let t=new Uint8Array(4);return l(t,e),t}function u(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++){let a=e.charCodeAt(r);if(a>127)throw TypeError("non-ASCII string encountered in encode()");t[r]=a}return t}function h(e){if(Uint8Array.fromBase64)return Uint8Array.fromBase64("string"==typeof e?e:c.decode(e),{alphabet:"base64url"});let t=e;t instanceof Uint8Array&&(t=c.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/");try{var r=t;if(Uint8Array.fromBase64)return Uint8Array.fromBase64(r);let e=atob(r),a=new Uint8Array(e.length);for(let t=0;t<e.length;t++)a[t]=e.charCodeAt(t);return a}catch{throw TypeError("The input to be decoded is not correctly encoded.")}}function f(e){let t=e;return("string"==typeof t&&(t=o.encode(t)),Uint8Array.prototype.toBase64)?t.toBase64({alphabet:"base64url",omitPadding:!0}):(function(e){if(Uint8Array.prototype.toBase64)return e.toBase64();let t=[];for(let r=0;r<e.length;r+=32768)t.push(String.fromCharCode.apply(null,e.subarray(r,r+32768)));return btoa(t.join(""))})(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}e.s(["concat",()=>d,"decoder",0,c,"encode",()=>u,"encoder",0,o,"uint32be",()=>y,"uint64be",()=>p],32802),e.s(["decode",()=>h,"encode",()=>f],63370);let w=Symbol();class m extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(e,t){super(e,t),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class A extends m{static code="ERR_JWT_CLAIM_VALIDATION_FAILED";code="ERR_JWT_CLAIM_VALIDATION_FAILED";claim;reason;payload;constructor(e,t,r="unspecified",a="unspecified"){super(e,{cause:{claim:r,reason:a,payload:t}}),this.claim=r,this.reason=a,this.payload=t}}class E extends m{static code="ERR_JWT_EXPIRED";code="ERR_JWT_EXPIRED";claim;reason;payload;constructor(e,t,r="unspecified",a="unspecified"){super(e,{cause:{claim:r,reason:a,payload:t}}),this.claim=r,this.reason=a,this.payload=t}}class g extends m{static code="ERR_JOSE_ALG_NOT_ALLOWED";code="ERR_JOSE_ALG_NOT_ALLOWED"}class b extends m{static code="ERR_JOSE_NOT_SUPPORTED";code="ERR_JOSE_NOT_SUPPORTED"}class S extends m{static code="ERR_JWE_DECRYPTION_FAILED";code="ERR_JWE_DECRYPTION_FAILED";constructor(e="decryption operation failed",t){super(e,t)}}class v extends m{static code="ERR_JWE_INVALID";code="ERR_JWE_INVALID"}class k extends m{static code="ERR_JWT_INVALID";code="ERR_JWT_INVALID"}class C extends m{static code="ERR_JWK_INVALID";code="ERR_JWK_INVALID"}class K extends m{[Symbol.asyncIterator];static code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";constructor(e="multiple matching keys found in the JSON Web Key Set",t){super(e,t)}}function H(e){switch(e){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new b(`Unsupported JWE Algorithm: ${e}`)}}function P(e,t){if(t.length<<3!==H(e))throw new v("Invalid Initialization Vector length")}function W(e,t){let r=e.byteLength<<3;if(r!==t)throw new v(`Invalid Content Encryption Key length. Expected ${t} bits, got ${r} bits`)}e.s(["JOSEAlgNotAllowed",()=>g,"JOSENotSupported",()=>b,"JWEDecryptionFailed",()=>S,"JWEInvalid",()=>v,"JWKInvalid",()=>C,"JWTClaimValidationFailed",()=>A,"JWTExpired",()=>E,"JWTInvalid",()=>k],65466);let T=(e,t="algorithm.name")=>TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`);function x(e,t,r){switch(t){case"A128GCM":case"A192GCM":case"A256GCM":{if("AES-GCM"!==e.algorithm.name)throw T("AES-GCM");let r=parseInt(t.slice(1,4),10);if(e.algorithm.length!==r)throw T(r,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if("AES-KW"!==e.algorithm.name)throw T("AES-KW");let r=parseInt(t.slice(1,4),10);if(e.algorithm.length!==r)throw T(r,"algorithm.length");break}case"ECDH":switch(e.algorithm.name){case"ECDH":case"X25519":break;default:throw T("ECDH or X25519")}break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if("PBKDF2"!==e.algorithm.name)throw T("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if("RSA-OAEP"!==e.algorithm.name)throw T("RSA-OAEP");let r=parseInt(t.slice(9),10)||1;if(parseInt(e.algorithm.hash.name.slice(4),10)!==r)throw T(`SHA-${r}`,"algorithm.hash");break}default:throw TypeError("CryptoKey does not support this operation")}if(r&&!e.usages.includes(r))throw TypeError(`CryptoKey does not support this operation, its usages must include ${r}.`)}function O(e,t,...r){if((r=r.filter(Boolean)).length>2){let t=r.pop();e+=`one of type ${r.join(", ")}, or ${t}.`}else 2===r.length?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor?.name&&(e+=` Received an instance of ${t.constructor.name}`),e}let U=(e,...t)=>O("Key must be ",e,...t),J=(e,t,...r)=>O(`Key for the ${e} algorithm must be `,t,...r);function I(e){if(!M(e))throw Error("CryptoKey instance expected")}let M=e=>{if(e?.[Symbol.toStringTag]==="CryptoKey")return!0;try{return e instanceof CryptoKey}catch{return!1}},R=e=>e?.[Symbol.toStringTag]==="KeyObject",D=e=>M(e)||R(e);async function _(e,t,r,a,i){if(!(r instanceof Uint8Array))throw TypeError(U(r,"Uint8Array"));let n=parseInt(e.slice(1,4),10),s=await crypto.subtle.importKey("raw",r.subarray(n>>3),"AES-CBC",!1,["encrypt"]),o=await crypto.subtle.importKey("raw",r.subarray(0,n>>3),{hash:`SHA-${n<<1}`,name:"HMAC"},!1,["sign"]),c=new Uint8Array(await crypto.subtle.encrypt({iv:a,name:"AES-CBC"},s,t)),l=d(i,a,c,p(i.length<<3));return{ciphertext:c,tag:new Uint8Array((await crypto.subtle.sign("HMAC",o,l)).slice(0,n>>3)),iv:a}}async function j(e,t,r,a,i){let n;r instanceof Uint8Array?n=await crypto.subtle.importKey("raw",r,"AES-GCM",!1,["encrypt"]):(x(r,e,"encrypt"),n=r);let s=new Uint8Array(await crypto.subtle.encrypt({additionalData:i,iv:a,name:"AES-GCM",tagLength:128},n,t)),o=s.slice(-16);return{ciphertext:s.slice(0,-16),tag:o,iv:a}}async function $(e,t,r,a,i){if(!M(r)&&!(r instanceof Uint8Array))throw TypeError(U(r,"CryptoKey","KeyObject","Uint8Array","JSON Web Key"));if(a)P(e,a);else a=crypto.getRandomValues(new Uint8Array(H(e)>>3));switch(e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return r instanceof Uint8Array&&W(r,parseInt(e.slice(-3),10)),_(e,t,r,a,i);case"A128GCM":case"A192GCM":case"A256GCM":return r instanceof Uint8Array&&W(r,parseInt(e.slice(1,4),10)),j(e,t,r,a,i);default:throw new b("Unsupported JWE Content Encryption Algorithm")}}function B(e,t){if(e.algorithm.length!==parseInt(t.slice(1,4),10))throw TypeError(`Invalid key size for alg: ${t}`)}function N(e,t,r){return e instanceof Uint8Array?crypto.subtle.importKey("raw",e,"AES-KW",!0,[r]):(x(e,t,r),e)}async function L(e,t,r){let a=await N(t,e,"wrapKey");B(a,e);let i=await crypto.subtle.importKey("raw",r,{hash:"SHA-256",name:"HMAC"},!0,["sign"]);return new Uint8Array(await crypto.subtle.wrapKey("raw",i,a,"AES-KW"))}async function G(e,t,r){let a=await N(t,e,"unwrapKey");B(a,e);let i=await crypto.subtle.unwrapKey("raw",r,a,"AES-KW",{hash:"SHA-256",name:"HMAC"},!0,["sign"]);return new Uint8Array(await crypto.subtle.exportKey("raw",i))}async function V(e,t){let r=`SHA-${e.slice(-3)}`;return new Uint8Array(await crypto.subtle.digest(r,t))}function z(e){return d(y(e.length),e)}async function F(e,t,r){let a=t>>3,i=Math.ceil(a/32),n=new Uint8Array(32*i);for(let t=1;t<=i;t++){let a=new Uint8Array(4+e.length+r.length);a.set(y(t),0),a.set(e,4),a.set(r,4+e.length);let i=await V("sha256",a);n.set(i,(t-1)*32)}return n.slice(0,a)}async function X(e,t,r,a,i=new Uint8Array,n=new Uint8Array){var s;x(e,"ECDH"),x(t,"ECDH","deriveBits");let o=d(z(u(r)),z(i),z(n),y(a),new Uint8Array);return F(new Uint8Array(await crypto.subtle.deriveBits({name:e.algorithm.name,public:e},t,"X25519"===(s=e).algorithm.name?256:Math.ceil(parseInt(s.algorithm.namedCurve.slice(-3),10)/8)<<3)),a,o)}function q(e){switch(e.algorithm.namedCurve){case"P-256":case"P-384":case"P-521":return!0;default:return"X25519"===e.algorithm.name}}async function Y(e,t,r,a){if(!(e instanceof Uint8Array)||e.length<8)throw new v("PBES2 Salt Input must be 8 or more octets");let i=d(u(t),Uint8Array.of(0),e),n=parseInt(t.slice(13,16),10),s={hash:`SHA-${t.slice(8,11)}`,iterations:r,name:"PBKDF2",salt:i},o=await (a instanceof Uint8Array?crypto.subtle.importKey("raw",a,"PBKDF2",!1,["deriveBits"]):(x(a,t,"deriveBits"),a));return new Uint8Array(await crypto.subtle.deriveBits(s,o,n))}async function Z(e,t,r,a=2048,i=crypto.getRandomValues(new Uint8Array(16))){let n=await Y(i,e,a,t);return{encryptedKey:await L(e.slice(-6),n,r),p2c:a,p2s:f(i)}}async function Q(e,t,r,a,i){let n=await Y(i,e,a,t);return G(e.slice(-6),n,r)}function ee(e,t){if(e.startsWith("RS")||e.startsWith("PS")){let{modulusLength:r}=t.algorithm;if("number"!=typeof r||r<2048)throw TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}}let et=e=>{switch(e){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return"RSA-OAEP";default:throw new b(`alg ${e} is not supported either by JOSE or your javascript runtime`)}};async function er(e,t,r){return x(t,e,"encrypt"),ee(e,t),new Uint8Array(await crypto.subtle.encrypt(et(e),t,r))}async function ea(e,t,r){return x(t,e,"decrypt"),ee(e,t),new Uint8Array(await crypto.subtle.decrypt(et(e),t,r))}function ei(e){if("object"!=typeof e||null===e||"[object Object]"!==Object.prototype.toString.call(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}e.s(["isObject",()=>ei],42020);let en=e=>ei(e)&&"string"==typeof e.kty;async function es(e){if(!e.alg)throw TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:t,keyUsages:r}=function(e){let t,r;switch(e.kty){case"AKP":switch(e.alg){case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":t={name:e.alg},r=e.priv?["sign"]:["verify"];break;default:throw new b('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"RSA":switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},r=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new b('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(e.alg){case"ES256":t={name:"ECDSA",namedCurve:"P-256"},r=e.d?["sign"]:["verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},r=e.d?["sign"]:["verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new b('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(e.alg){case"Ed25519":case"EdDSA":t={name:"Ed25519"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new b('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new b('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:r}}(e),a={...e};return"AKP"!==a.kty&&delete a.alg,delete a.use,crypto.subtle.importKey("jwk",a,t,e.ext??(!e.d&&!e.priv),e.key_ops??r)}let eo=async(e,t,a,i=!1)=>{let n=(r||=new WeakMap).get(e);if(n?.[a])return n[a];let s=await es({...t,alg:a});return i&&Object.freeze(e),n?n[a]=s:r.set(e,{[a]:s}),s};async function ec(e,t){if(e instanceof Uint8Array||M(e))return e;if(R(e)){if("secret"===e.type)return e.export();if("toCryptoKey"in e&&"function"==typeof e.toCryptoKey)try{return((e,t)=>{let a,i=(r||=new WeakMap).get(e);if(i?.[t])return i[t];let n="public"===e.type,s=!!n;if("x25519"===e.asymmetricKeyType){switch(t){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}a=e.toCryptoKey(e.asymmetricKeyType,s,n?[]:["deriveBits"])}if("ed25519"===e.asymmetricKeyType){if("EdDSA"!==t&&"Ed25519"!==t)throw TypeError("given KeyObject instance cannot be used for this algorithm");a=e.toCryptoKey(e.asymmetricKeyType,s,[n?"verify":"sign"])}switch(e.asymmetricKeyType){case"ml-dsa-44":case"ml-dsa-65":case"ml-dsa-87":if(t!==e.asymmetricKeyType.toUpperCase())throw TypeError("given KeyObject instance cannot be used for this algorithm");a=e.toCryptoKey(e.asymmetricKeyType,s,[n?"verify":"sign"])}if("rsa"===e.asymmetricKeyType){let r;switch(t){case"RSA-OAEP":r="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":r="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":r="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":r="SHA-512";break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}if(t.startsWith("RSA-OAEP"))return e.toCryptoKey({name:"RSA-OAEP",hash:r},s,n?["encrypt"]:["decrypt"]);a=e.toCryptoKey({name:t.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:r},s,[n?"verify":"sign"])}if("ec"===e.asymmetricKeyType){let r=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get(e.asymmetricKeyDetails?.namedCurve);if(!r)throw TypeError("given KeyObject instance cannot be used for this algorithm");"ES256"===t&&"P-256"===r&&(a=e.toCryptoKey({name:"ECDSA",namedCurve:r},s,[n?"verify":"sign"])),"ES384"===t&&"P-384"===r&&(a=e.toCryptoKey({name:"ECDSA",namedCurve:r},s,[n?"verify":"sign"])),"ES512"===t&&"P-521"===r&&(a=e.toCryptoKey({name:"ECDSA",namedCurve:r},s,[n?"verify":"sign"])),t.startsWith("ECDH-ES")&&(a=e.toCryptoKey({name:"ECDH",namedCurve:r},s,n?[]:["deriveBits"]))}if(!a)throw TypeError("given KeyObject instance cannot be used for this algorithm");return i?i[t]=a:r.set(e,{[t]:a}),a})(e,t)}catch(e){if(e instanceof TypeError)throw e}let a=e.export({format:"jwk"});return eo(e,a,t)}if(en(e))return e.k?h(e.k):eo(e,e,t,!0);throw Error("unreachable")}function ed(e){switch(e){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new b(`Unsupported JWE Algorithm: ${e}`)}}let el=e=>crypto.getRandomValues(new Uint8Array(ed(e)>>3));async function ep(e){if(R(e))if("secret"!==e.type)return e.export({format:"jwk"});else e=e.export();if(e instanceof Uint8Array)return{kty:"oct",k:f(e)};if(!M(e))throw TypeError(U(e,"CryptoKey","KeyObject","Uint8Array"));if(!e.extractable)throw TypeError("non-extractable CryptoKey cannot be exported as a JWK");let{ext:t,key_ops:r,alg:a,use:i,...n}=await crypto.subtle.exportKey("jwk",e);return"AKP"===n.kty&&(n.alg=a),n}async function ey(e){return ep(e)}async function eu(e,t){if(!(e instanceof Uint8Array))throw TypeError("First argument must be a buffer");if(!(t instanceof Uint8Array))throw TypeError("Second argument must be a buffer");let r={name:"HMAC",hash:"SHA-256"},a=await crypto.subtle.generateKey(r,!1,["sign"]),i=new Uint8Array(await crypto.subtle.sign(r,a,e)),n=new Uint8Array(await crypto.subtle.sign(r,a,t)),s=0,o=-1;for(;++o<32;)s|=i[o]^n[o];return 0===s}async function eh(e,t,r,a,i,n){let s,o;if(!(t instanceof Uint8Array))throw TypeError(U(t,"Uint8Array"));let c=parseInt(e.slice(1,4),10),l=await crypto.subtle.importKey("raw",t.subarray(c>>3),"AES-CBC",!1,["decrypt"]),y=await crypto.subtle.importKey("raw",t.subarray(0,c>>3),{hash:`SHA-${c<<1}`,name:"HMAC"},!1,["sign"]),u=d(n,a,r,p(n.length<<3)),h=new Uint8Array((await crypto.subtle.sign("HMAC",y,u)).slice(0,c>>3));try{s=await eu(i,h)}catch{}if(!s)throw new S;try{o=new Uint8Array(await crypto.subtle.decrypt({iv:a,name:"AES-CBC"},l,r))}catch{}if(!o)throw new S;return o}async function ef(e,t,r,a,i,n){let s;t instanceof Uint8Array?s=await crypto.subtle.importKey("raw",t,"AES-GCM",!1,["decrypt"]):(x(t,e,"decrypt"),s=t);try{return new Uint8Array(await crypto.subtle.decrypt({additionalData:n,iv:a,name:"AES-GCM",tagLength:128},s,d(r,i)))}catch{throw new S}}async function ew(e,t,r,a,i,n){if(!M(t)&&!(t instanceof Uint8Array))throw TypeError(U(t,"CryptoKey","KeyObject","Uint8Array","JSON Web Key"));if(!a)throw new v("JWE Initialization Vector missing");if(!i)throw new v("JWE Authentication Tag missing");switch(P(e,a),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return t instanceof Uint8Array&&W(t,parseInt(e.slice(-3),10)),eh(e,t,r,a,i,n);case"A128GCM":case"A192GCM":case"A256GCM":return t instanceof Uint8Array&&W(t,parseInt(e.slice(1,4),10)),ef(e,t,r,a,i,n);default:throw new b("Unsupported JWE Content Encryption Algorithm")}}async function em(e,t,r,a){let i=e.slice(0,7),n=await $(i,r,t,a,new Uint8Array);return{encryptedKey:n.ciphertext,iv:f(n.iv),tag:f(n.tag)}}async function eA(e,t,r,a,i){return ew(e.slice(0,7),t,r,a,i,new Uint8Array)}async function eE(e,t,r,a,i={}){let n,s,o;switch(e){case"dir":o=r;break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let c;if(I(r),!q(r))throw new b("ECDH with the provided key is not allowed or not supported by your javascript runtime");let{apu:d,apv:l}=i;c=i.epk?await ec(i.epk,e):(await crypto.subtle.generateKey(r.algorithm,!0,["deriveBits"])).privateKey;let{x:p,y,crv:u,kty:h}=await ey(c),w=await X(r,c,"ECDH-ES"===e?t:e,"ECDH-ES"===e?ed(t):parseInt(e.slice(-5,-2),10),d,l);if(s={epk:{x:p,crv:u,kty:h}},"EC"===h&&(s.epk.y=y),d&&(s.apu=f(d)),l&&(s.apv=f(l)),"ECDH-ES"===e){o=w;break}o=a||el(t);let m=e.slice(-6);n=await L(m,w,o);break}case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":o=a||el(t),I(r),n=await er(e,r,o);break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{o=a||el(t);let{p2c:c,p2s:d}=i;({encryptedKey:n,...s}=await Z(e,r,o,c,d));break}case"A128KW":case"A192KW":case"A256KW":o=a||el(t),n=await L(e,r,o);break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{o=a||el(t);let{iv:c}=i;({encryptedKey:n,...s}=await em(e,r,o,c));break}default:throw new b('Invalid or unsupported "alg" (JWE Algorithm) header value')}return{cek:o,encryptedKey:n,parameters:s}}function eg(...e){let t,r=e.filter(Boolean);if(0===r.length||1===r.length)return!0;for(let e of r){let r=Object.keys(e);if(!t||0===t.size){t=new Set(r);continue}for(let e of r){if(t.has(e))return!1;t.add(e)}}return!0}function eb(e,t,r,a,i){let n;if(void 0!==i.crit&&a?.crit===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!a||void 0===a.crit)return new Set;if(!Array.isArray(a.crit)||0===a.crit.length||a.crit.some(e=>"string"!=typeof e||0===e.length))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let s of(n=void 0!==r?new Map([...Object.entries(r),...t.entries()]):t,a.crit)){if(!n.has(s))throw new b(`Extension Header Parameter "${s}" is not recognized`);if(void 0===i[s])throw new e(`Extension Header Parameter "${s}" is missing`);if(n.get(s)&&void 0===a[s])throw new e(`Extension Header Parameter "${s}" MUST be integrity protected`)}return new Set(a.crit)}let eS=e=>e?.[Symbol.toStringTag],ev=(e,t,r)=>{if(void 0!==t.use){let e;switch(r){case"sign":case"verify":e="sig";break;case"encrypt":case"decrypt":e="enc"}if(t.use!==e)throw TypeError(`Invalid key for this operation, its "use" must be "${e}" when present`)}if(void 0!==t.alg&&t.alg!==e)throw TypeError(`Invalid key for this operation, its "alg" must be "${e}" when present`);if(Array.isArray(t.key_ops)){let a;switch(!0){case"sign"===r||"verify"===r:case"dir"===e:case e.includes("CBC-HS"):a=r;break;case e.startsWith("PBES2"):a="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(e):a=!e.includes("GCM")&&e.endsWith("KW")?"encrypt"===r?"wrapKey":"unwrapKey":r;break;case"encrypt"===r&&e.startsWith("RSA"):a="wrapKey";break;case"decrypt"===r:a=e.startsWith("RSA")?"unwrapKey":"deriveBits"}if(a&&t.key_ops?.includes?.(a)===!1)throw TypeError(`Invalid key for this operation, its "key_ops" must include "${a}" when present`)}return!0};function ek(e,t,r){switch(e.substring(0,2)){case"A1":case"A2":case"di":case"HS":case"PB":((e,t,r)=>{if(!(t instanceof Uint8Array)){if(en(t)){if("oct"===t.kty&&"string"==typeof t.k&&ev(e,t,r))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!D(t))throw TypeError(J(e,t,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if("secret"!==t.type)throw TypeError(`${eS(t)} instances for symmetric algorithms must be of type "secret"`)}})(e,t,r);break;default:((e,t,r)=>{if(en(t))switch(r){case"decrypt":case"sign":if("oct"!==t.kty&&("AKP"===t.kty&&"string"==typeof t.priv||"string"==typeof t.d)&&ev(e,t,r))return;throw TypeError("JSON Web Key for this operation must be a private JWK");case"encrypt":case"verify":if("oct"!==t.kty&&void 0===t.d&&void 0===t.priv&&ev(e,t,r))return;throw TypeError("JSON Web Key for this operation must be a public JWK")}if(!D(t))throw TypeError(J(e,t,"CryptoKey","KeyObject","JSON Web Key"));if("secret"===t.type)throw TypeError(`${eS(t)} instances for asymmetric algorithms must not be of type "secret"`);if("public"===t.type)switch(r){case"sign":throw TypeError(`${eS(t)} instances for asymmetric algorithm signing must be of type "private"`);case"decrypt":throw TypeError(`${eS(t)} instances for asymmetric algorithm decryption must be of type "private"`)}if("private"===t.type)switch(r){case"verify":throw TypeError(`${eS(t)} instances for asymmetric algorithm verifying must be of type "public"`);case"encrypt":throw TypeError(`${eS(t)} instances for asymmetric algorithm encryption must be of type "public"`)}})(e,t,r)}}class eC{#e;#t;#r;#a;#i;#n;#s;#o;constructor(e){if(!(e instanceof Uint8Array))throw TypeError("plaintext must be an instance of Uint8Array");this.#e=e}setKeyManagementParameters(e){if(this.#o)throw TypeError("setKeyManagementParameters can only be called once");return this.#o=e,this}setProtectedHeader(e){if(this.#t)throw TypeError("setProtectedHeader can only be called once");return this.#t=e,this}setSharedUnprotectedHeader(e){if(this.#r)throw TypeError("setSharedUnprotectedHeader can only be called once");return this.#r=e,this}setUnprotectedHeader(e){if(this.#a)throw TypeError("setUnprotectedHeader can only be called once");return this.#a=e,this}setAdditionalAuthenticatedData(e){return this.#i=e,this}setContentEncryptionKey(e){if(this.#n)throw TypeError("setContentEncryptionKey can only be called once");return this.#n=e,this}setInitializationVector(e){if(this.#s)throw TypeError("setInitializationVector can only be called once");return this.#s=e,this}async encrypt(e,t){let r,a,i,n,s,o;if(!this.#t&&!this.#a&&!this.#r)throw new v("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!eg(this.#t,this.#a,this.#r))throw new v("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let c={...this.#t,...this.#a,...this.#r};if(eb(v,new Map,t?.crit,this.#t,c),void 0!==c.zip)throw new b('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');let{alg:l,enc:p}=c;if("string"!=typeof l||!l)throw new v('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("string"!=typeof p||!p)throw new v('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(this.#n&&("dir"===l||"ECDH-ES"===l))throw TypeError(`setContentEncryptionKey cannot be called with JWE "alg" (Algorithm) Header ${l}`);ek("dir"===l?p:l,e,"encrypt");{let i,n=await ec(e,l);({cek:a,encryptedKey:r,parameters:i}=await eE(l,p,n,this.#n,this.#o)),i&&(t&&w in t?this.#a?this.#a={...this.#a,...i}:this.setUnprotectedHeader(i):this.#t?this.#t={...this.#t,...i}:this.setProtectedHeader(i))}if(this.#t?s=u(n=f(JSON.stringify(this.#t))):(n="",s=new Uint8Array),this.#i){let e=u(o=f(this.#i));i=d(s,u("."),e)}else i=s;let{ciphertext:y,tag:h,iv:m}=await $(p,this.#e,a,this.#s,i),A={ciphertext:f(y)};return m&&(A.iv=f(m)),h&&(A.tag=f(h)),r&&(A.encrypted_key=f(r)),o&&(A.aad=o),this.#t&&(A.protected=n),this.#r&&(A.unprotected=this.#r),this.#a&&(A.header=this.#a),A}}class eK{#c;constructor(e){this.#c=new eC(e)}setContentEncryptionKey(e){return this.#c.setContentEncryptionKey(e),this}setInitializationVector(e){return this.#c.setInitializationVector(e),this}setProtectedHeader(e){return this.#c.setProtectedHeader(e),this}setKeyManagementParameters(e){return this.#c.setKeyManagementParameters(e),this}async encrypt(e,t){let r=await this.#c.encrypt(e,t);return[r.protected,r.encrypted_key,r.iv,r.ciphertext,r.tag].join(".")}}let eH=e=>Math.floor(e.getTime()/1e3),eP=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;function eW(e){let t,r=eP.exec(e);if(!r||r[4]&&r[1])throw TypeError("Invalid time period format");let a=parseFloat(r[2]);switch(r[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":t=Math.round(a);break;case"minute":case"minutes":case"min":case"mins":case"m":t=Math.round(60*a);break;case"hour":case"hours":case"hr":case"hrs":case"h":t=Math.round(3600*a);break;case"day":case"days":case"d":t=Math.round(86400*a);break;case"week":case"weeks":case"w":t=Math.round(604800*a);break;default:t=Math.round(0x1e187e0*a)}return"-"===r[1]||"ago"===r[4]?-t:t}function eT(e,t){if(!Number.isFinite(t))throw TypeError(`Invalid ${e} input`);return t}let ex=e=>e.includes("/")?e.toLowerCase():`application/${e.toLowerCase()}`;class eO{#d;constructor(e){if(!ei(e))throw TypeError("JWT Claims Set MUST be an object");this.#d=structuredClone(e)}data(){return o.encode(JSON.stringify(this.#d))}get iss(){return this.#d.iss}set iss(e){this.#d.iss=e}get sub(){return this.#d.sub}set sub(e){this.#d.sub=e}get aud(){return this.#d.aud}set aud(e){this.#d.aud=e}set jti(e){this.#d.jti=e}set nbf(e){"number"==typeof e?this.#d.nbf=eT("setNotBefore",e):e instanceof Date?this.#d.nbf=eT("setNotBefore",eH(e)):this.#d.nbf=eH(new Date)+eW(e)}set exp(e){"number"==typeof e?this.#d.exp=eT("setExpirationTime",e):e instanceof Date?this.#d.exp=eT("setExpirationTime",eH(e)):this.#d.exp=eH(new Date)+eW(e)}set iat(e){void 0===e?this.#d.iat=eH(new Date):e instanceof Date?this.#d.iat=eT("setIssuedAt",eH(e)):"string"==typeof e?this.#d.iat=eT("setIssuedAt",eH(new Date)+eW(e)):this.#d.iat=eT("setIssuedAt",e)}}class eU{#n;#s;#o;#t;#l;#p;#y;#u;constructor(e={}){this.#u=new eO(e)}setIssuer(e){return this.#u.iss=e,this}setSubject(e){return this.#u.sub=e,this}setAudience(e){return this.#u.aud=e,this}setJti(e){return this.#u.jti=e,this}setNotBefore(e){return this.#u.nbf=e,this}setExpirationTime(e){return this.#u.exp=e,this}setIssuedAt(e){return this.#u.iat=e,this}setProtectedHeader(e){if(this.#t)throw TypeError("setProtectedHeader can only be called once");return this.#t=e,this}setKeyManagementParameters(e){if(this.#o)throw TypeError("setKeyManagementParameters can only be called once");return this.#o=e,this}setContentEncryptionKey(e){if(this.#n)throw TypeError("setContentEncryptionKey can only be called once");return this.#n=e,this}setInitializationVector(e){if(this.#s)throw TypeError("setInitializationVector can only be called once");return this.#s=e,this}replicateIssuerAsHeader(){return this.#l=!0,this}replicateSubjectAsHeader(){return this.#p=!0,this}replicateAudienceAsHeader(){return this.#y=!0,this}async encrypt(e,t){let r=new eK(this.#u.data());return this.#t&&(this.#l||this.#p||this.#y)&&(this.#t={...this.#t,iss:this.#l?this.#u.iss:void 0,sub:this.#p?this.#u.sub:void 0,aud:this.#y?this.#u.aud:void 0}),r.setProtectedHeader(this.#t),this.#s&&r.setInitializationVector(this.#s),this.#n&&r.setContentEncryptionKey(this.#n),this.#o&&r.setKeyManagementParameters(this.#o),r.encrypt(e,t)}}e.s(["EncryptJWT",()=>eU],13366);var eJ=e.i(63370);e.s(["base64url",0,eJ],31582);let eI=(e,t)=>{if("string"!=typeof e||!e)throw new C(`${t} missing or invalid`)};async function eM(e,t){let r,a;if(en(e))r=e;else if(D(e))r=await ey(e);else throw TypeError(U(e,"CryptoKey","KeyObject","JSON Web Key"));if("sha256"!==(t??="sha256")&&"sha384"!==t&&"sha512"!==t)throw TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');switch(r.kty){case"AKP":eI(r.alg,'"alg" (Algorithm) Parameter'),eI(r.pub,'"pub" (Public key) Parameter'),a={alg:r.alg,kty:r.kty,pub:r.pub};break;case"EC":eI(r.crv,'"crv" (Curve) Parameter'),eI(r.x,'"x" (X Coordinate) Parameter'),eI(r.y,'"y" (Y Coordinate) Parameter'),a={crv:r.crv,kty:r.kty,x:r.x,y:r.y};break;case"OKP":eI(r.crv,'"crv" (Subtype of Key Pair) Parameter'),eI(r.x,'"x" (Public Key) Parameter'),a={crv:r.crv,kty:r.kty,x:r.x};break;case"RSA":eI(r.e,'"e" (Exponent) Parameter'),eI(r.n,'"n" (Modulus) Parameter'),a={e:r.e,kty:r.kty,n:r.n};break;case"oct":eI(r.k,'"k" (Key Value) Parameter'),a={k:r.k,kty:r.kty};break;default:throw new b('"kty" (Key Type) Parameter missing or unsupported')}let i=u(JSON.stringify(a));return f(await V(t,i))}async function eR(e,t,r){let a;if(!ei(e))throw TypeError("JWK must be an object");switch(t??=e.alg,a??=r?.extractable??e.ext,e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw TypeError('missing "k" (Key Value) Parameter value');return h(e.k);case"RSA":if("oth"in e&&void 0!==e.oth)throw new b('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');return es({...e,alg:t,ext:a});case"AKP":if("string"!=typeof e.alg||!e.alg)throw TypeError('missing "alg" (Algorithm) Parameter value');if(void 0!==t&&t!==e.alg)throw TypeError("JWK alg and alg option value mismatch");return es({...e,ext:a});case"EC":case"OKP":return es({...e,alg:t,ext:a});default:throw new b('Unsupported "kty" (Key Type) Parameter value')}}async function eD(e,t,r,a,i){switch(e){case"dir":if(void 0!==r)throw new v("Encountered unexpected JWE Encrypted Key");return t;case"ECDH-ES":if(void 0!==r)throw new v("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let i,n;if(!ei(a.epk))throw new v('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(I(t),!q(t))throw new b("ECDH with the provided key is not allowed or not supported by your javascript runtime");let s=await eR(a.epk,e);if(I(s),void 0!==a.apu){if("string"!=typeof a.apu)throw new v('JOSE Header "apu" (Agreement PartyUInfo) invalid');try{i=h(a.apu)}catch{throw new v("Failed to base64url decode the apu")}}if(void 0!==a.apv){if("string"!=typeof a.apv)throw new v('JOSE Header "apv" (Agreement PartyVInfo) invalid');try{n=h(a.apv)}catch{throw new v("Failed to base64url decode the apv")}}let o=await X(s,t,"ECDH-ES"===e?a.enc:e,"ECDH-ES"===e?ed(a.enc):parseInt(e.slice(-5,-2),10),i,n);if("ECDH-ES"===e)return o;if(void 0===r)throw new v("JWE Encrypted Key missing");return G(e.slice(-6),o,r)}case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":if(void 0===r)throw new v("JWE Encrypted Key missing");return I(t),ea(e,t,r);case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{let n;if(void 0===r)throw new v("JWE Encrypted Key missing");if("number"!=typeof a.p2c)throw new v('JOSE Header "p2c" (PBES2 Count) missing or invalid');let s=i?.maxPBES2Count||1e4;if(a.p2c>s)throw new v('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if("string"!=typeof a.p2s)throw new v('JOSE Header "p2s" (PBES2 Salt) missing or invalid');try{n=h(a.p2s)}catch{throw new v("Failed to base64url decode the p2s")}return Q(e,t,r,a.p2c,n)}case"A128KW":case"A192KW":case"A256KW":if(void 0===r)throw new v("JWE Encrypted Key missing");return G(e,t,r);case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{let i,n;if(void 0===r)throw new v("JWE Encrypted Key missing");if("string"!=typeof a.iv)throw new v('JOSE Header "iv" (Initialization Vector) missing or invalid');if("string"!=typeof a.tag)throw new v('JOSE Header "tag" (Authentication Tag) missing or invalid');try{i=h(a.iv)}catch{throw new v("Failed to base64url decode the iv")}try{n=h(a.tag)}catch{throw new v("Failed to base64url decode the tag")}return eA(e,t,r,i,n)}default:throw new b('Invalid or unsupported "alg" (JWE Algorithm) header value')}}function e_(e,t){if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)}async function ej(e,t,r){let a,i,n,s,o,l,p;if(!ei(e))throw new v("Flattened JWE must be an object");if(void 0===e.protected&&void 0===e.header&&void 0===e.unprotected)throw new v("JOSE Header missing");if(void 0!==e.iv&&"string"!=typeof e.iv)throw new v("JWE Initialization Vector incorrect type");if("string"!=typeof e.ciphertext)throw new v("JWE Ciphertext missing or incorrect type");if(void 0!==e.tag&&"string"!=typeof e.tag)throw new v("JWE Authentication Tag incorrect type");if(void 0!==e.protected&&"string"!=typeof e.protected)throw new v("JWE Protected Header incorrect type");if(void 0!==e.encrypted_key&&"string"!=typeof e.encrypted_key)throw new v("JWE Encrypted Key incorrect type");if(void 0!==e.aad&&"string"!=typeof e.aad)throw new v("JWE AAD incorrect type");if(void 0!==e.header&&!ei(e.header))throw new v("JWE Shared Unprotected Header incorrect type");if(void 0!==e.unprotected&&!ei(e.unprotected))throw new v("JWE Per-Recipient Unprotected Header incorrect type");if(e.protected)try{let t=h(e.protected);a=JSON.parse(c.decode(t))}catch{throw new v("JWE Protected Header is invalid")}if(!eg(a,e.header,e.unprotected))throw new v("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");let y={...a,...e.header,...e.unprotected};if(eb(v,new Map,r?.crit,a,y),void 0!==y.zip)throw new b('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');let{alg:f,enc:w}=y;if("string"!=typeof f||!f)throw new v("missing JWE Algorithm (alg) in JWE Header");if("string"!=typeof w||!w)throw new v("missing JWE Encryption Algorithm (enc) in JWE Header");let m=r&&e_("keyManagementAlgorithms",r.keyManagementAlgorithms),A=r&&e_("contentEncryptionAlgorithms",r.contentEncryptionAlgorithms);if(m&&!m.has(f)||!m&&f.startsWith("PBES2"))throw new g('"alg" (Algorithm) Header Parameter value not allowed');if(A&&!A.has(w))throw new g('"enc" (Encryption Algorithm) Header Parameter value not allowed');if(void 0!==e.encrypted_key)try{i=h(e.encrypted_key)}catch{throw new v("Failed to base64url decode the encrypted_key")}let E=!1;"function"==typeof t&&(t=await t(a,e),E=!0),ek("dir"===f?w:f,t,"decrypt");let S=await ec(t,f);try{n=await eD(f,S,i,y,r)}catch(e){if(e instanceof TypeError||e instanceof v||e instanceof b)throw e;n=el(w)}if(void 0!==e.iv)try{s=h(e.iv)}catch{throw new v("Failed to base64url decode the iv")}if(void 0!==e.tag)try{o=h(e.tag)}catch{throw new v("Failed to base64url decode the tag")}let k=void 0!==e.protected?u(e.protected):new Uint8Array;l=void 0!==e.aad?d(k,u("."),u(e.aad)):k;try{p=h(e.ciphertext)}catch{throw new v("Failed to base64url decode the ciphertext")}let C={plaintext:await ew(w,n,p,s,o,l)};if(void 0!==e.protected&&(C.protectedHeader=a),void 0!==e.aad)try{C.additionalAuthenticatedData=h(e.aad)}catch{throw new v("Failed to base64url decode the aad")}return(void 0!==e.unprotected&&(C.sharedUnprotectedHeader=e.unprotected),void 0!==e.header&&(C.unprotectedHeader=e.header),E)?{...C,key:S}:C}async function e$(e,t,r){if(e instanceof Uint8Array&&(e=c.decode(e)),"string"!=typeof e)throw new v("Compact JWE must be a string or Uint8Array");let{0:a,1:i,2:n,3:s,4:o,length:d}=e.split(".");if(5!==d)throw new v("Invalid Compact JWE");let l=await ej({ciphertext:s,iv:n||void 0,protected:a,tag:o||void 0,encrypted_key:i||void 0},t,r),p={plaintext:l.plaintext,protectedHeader:l.protectedHeader};return"function"==typeof t?{...p,key:l.key}:p}async function eB(e,t,r){let a=await e$(e,t,r),i=function(e,t,r={}){var a,i;let n,s;try{n=JSON.parse(c.decode(t))}catch{}if(!ei(n))throw new k("JWT Claims Set must be a top-level JSON object");let{typ:o}=r;if(o&&("string"!=typeof e.typ||ex(e.typ)!==ex(o)))throw new A('unexpected "typ" JWT header value',n,"typ","check_failed");let{requiredClaims:d=[],issuer:l,subject:p,audience:y,maxTokenAge:u}=r,h=[...d];for(let e of(void 0!==u&&h.push("iat"),void 0!==y&&h.push("aud"),void 0!==p&&h.push("sub"),void 0!==l&&h.push("iss"),new Set(h.reverse())))if(!(e in n))throw new A(`missing required "${e}" claim`,n,e,"missing");if(l&&!(Array.isArray(l)?l:[l]).includes(n.iss))throw new A('unexpected "iss" claim value',n,"iss","check_failed");if(p&&n.sub!==p)throw new A('unexpected "sub" claim value',n,"sub","check_failed");if(y&&(a=n.aud,i="string"==typeof y?[y]:y,"string"==typeof a?!i.includes(a):!(Array.isArray(a)&&i.some(Set.prototype.has.bind(new Set(a))))))throw new A('unexpected "aud" claim value',n,"aud","check_failed");switch(typeof r.clockTolerance){case"string":s=eW(r.clockTolerance);break;case"number":s=r.clockTolerance;break;case"undefined":s=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:f}=r,w=eH(f||new Date);if((void 0!==n.iat||u)&&"number"!=typeof n.iat)throw new A('"iat" claim must be a number',n,"iat","invalid");if(void 0!==n.nbf){if("number"!=typeof n.nbf)throw new A('"nbf" claim must be a number',n,"nbf","invalid");if(n.nbf>w+s)throw new A('"nbf" claim timestamp check failed',n,"nbf","check_failed")}if(void 0!==n.exp){if("number"!=typeof n.exp)throw new A('"exp" claim must be a number',n,"exp","invalid");if(n.exp<=w-s)throw new E('"exp" claim timestamp check failed',n,"exp","check_failed")}if(u){let e=w-n.iat;if(e-s>("number"==typeof u?u:eW(u)))throw new E('"iat" claim timestamp check failed (too far in the past)',n,"iat","check_failed");if(e<0-s)throw new A('"iat" claim timestamp check failed (it should be in the past)',n,"iat","check_failed")}return n}(a.protectedHeader,a.plaintext,r),{protectedHeader:n}=a;if(void 0!==n.iss&&n.iss!==i.iss)throw new A('replicated "iss" claim header parameter mismatch',i,"iss","mismatch");if(void 0!==n.sub&&n.sub!==i.sub)throw new A('replicated "sub" claim header parameter mismatch',i,"sub","mismatch");if(void 0!==n.aud&&JSON.stringify(n.aud)!==JSON.stringify(i.aud))throw new A('replicated "aud" claim header parameter mismatch',i,"aud","mismatch");let s={payload:i,protectedHeader:n};return"function"==typeof t?{...s,key:a.key}:s}e.s(["calculateJwkThumbprint",()=>eM],12319),e.s(["jwtDecrypt",()=>eB],72448)},25944,45571,e=>{"use strict";let t;var r=e.i(11445),a=e.i(13366),i=e.i(31582),n=e.i(12319),s=e.i(72448),o=e.i(78742),c=e.i(27365);let d=/^[!#$%&'*+\-.^_`|~0-9A-Za-z]+$/,l=/^("?)[\u0021\u0023-\u002B\u002D-\u003A\u003C-\u005B\u005D-\u007E]*\1$/,p=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,y=/^[\u0020-\u003A\u003D-\u007E]*$/,u=Object.prototype.toString,h=((t=function(){}).prototype=Object.create(null),t);function f(e,t){let r=new h,a=e.length;if(a<2)return r;let i=t?.decode||E,n=0;do{let t=e.indexOf("=",n);if(-1===t)break;let s=e.indexOf(";",n),o=-1===s?a:s;if(t>o){n=e.lastIndexOf(";",t-1)+1;continue}let c=w(e,n,t),d=m(e,t,c),l=e.slice(c,d);if(void 0===r[l]){let a=w(e,t+1,o),n=m(e,o,a),s=i(e.slice(a,n));r[l]=s}n=o+1}while(n<a)return r}function w(e,t,r){do{let r=e.charCodeAt(t);if(32!==r&&9!==r)return t}while(++t<r)return r}function m(e,t,r){for(;t>r;){let r=e.charCodeAt(--t);if(32!==r&&9!==r)return t+1}return r}function A(e,t,r){let a=r?.encode||encodeURIComponent;if(!d.test(e))throw TypeError(`argument name is invalid: ${e}`);let i=a(t);if(!l.test(i))throw TypeError(`argument val is invalid: ${t}`);let n=e+"="+i;if(!r)return n;if(void 0!==r.maxAge){if(!Number.isInteger(r.maxAge))throw TypeError(`option maxAge is invalid: ${r.maxAge}`);n+="; Max-Age="+r.maxAge}if(r.domain){if(!p.test(r.domain))throw TypeError(`option domain is invalid: ${r.domain}`);n+="; Domain="+r.domain}if(r.path){if(!y.test(r.path))throw TypeError(`option path is invalid: ${r.path}`);n+="; Path="+r.path}if(r.expires){var s;if(s=r.expires,"[object Date]"!==u.call(s)||!Number.isFinite(r.expires.valueOf()))throw TypeError(`option expires is invalid: ${r.expires}`);n+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(n+="; HttpOnly"),r.secure&&(n+="; Secure"),r.partitioned&&(n+="; Partitioned"),r.priority)switch("string"==typeof r.priority?r.priority.toLowerCase():void 0){case"low":n+="; Priority=Low";break;case"medium":n+="; Priority=Medium";break;case"high":n+="; Priority=High";break;default:throw TypeError(`option priority is invalid: ${r.priority}`)}if(r.sameSite)switch("string"==typeof r.sameSite?r.sameSite.toLowerCase():r.sameSite){case!0:case"strict":n+="; SameSite=Strict";break;case"lax":n+="; SameSite=Lax";break;case"none":n+="; SameSite=None";break;default:throw TypeError(`option sameSite is invalid: ${r.sameSite}`)}return n}function E(e){if(-1===e.indexOf("%"))return e;try{return decodeURIComponent(e)}catch(t){return e}}e.s(["parse",()=>f,"serialize",()=>A],45571);let{parse:g}=e.i(45571),b="A256CBC-HS512";async function S(e){let{token:t={},secret:r,maxAge:s=2592e3,salt:o}=e,c=Array.isArray(r)?r:[r],d=await C(b,c[0],o),l=await (0,n.calculateJwkThumbprint)({kty:"oct",k:i.base64url.encode(d)},`sha${d.byteLength<<3}`);return await new a.EncryptJWT(t).setProtectedHeader({alg:"dir",enc:b,kid:l}).setIssuedAt().setExpirationTime((Date.now()/1e3|0)+s).setJti(crypto.randomUUID()).encrypt(d)}async function v(e){let{token:t,secret:r,salt:a}=e,o=Array.isArray(r)?r:[r];if(!t)return null;let{payload:c}=await (0,s.jwtDecrypt)(t,async({kid:e,enc:t})=>{for(let r of o){let s=await C(t,r,a);if(void 0===e||e===await (0,n.calculateJwkThumbprint)({kty:"oct",k:i.base64url.encode(s)},`sha${s.byteLength<<3}`))return s}throw Error("no matching decryption secret")},{clockTolerance:15,keyManagementAlgorithms:["dir"],contentEncryptionAlgorithms:[b,"A256GCM"]});return c}async function k(e){let{secureCookie:t,cookieName:r=(0,o.defaultCookies)(t??!1).sessionToken.name,decode:a=v,salt:i=r,secret:n,logger:s=console,raw:d,req:l}=e;if(!l)throw Error("Must pass `req` to JWT getToken()");let p=l.headers instanceof Headers?l.headers:new Headers(l.headers),y=new o.SessionStore({name:r,options:{secure:t}},g(p.get("cookie")??""),s).value,u=p.get("authorization");if(y||u?.split(" ")[0]!=="Bearer"||(y=decodeURIComponent(u.split(" ")[1])),!y)return null;if(d)return y;if(!n)throw new c.MissingSecret("Must pass `secret` if not set to JWT getToken()");try{return await a({token:y,secret:n,salt:i})}catch{return null}}async function C(e,t,a){let i;switch(e){case"A256CBC-HS512":i=64;break;case"A256GCM":i=32;break;default:throw Error("Unsupported JWT Content Encryption Algorithm")}return await (0,r.hkdf)("sha256",t,a,`Auth.js Generated Encryption Key (${a})`,i)}e.s(["decode",()=>v,"encode",()=>S,"getToken",()=>k],25944)}];

//# sourceMappingURL=node_modules_82ff6494._.js.map