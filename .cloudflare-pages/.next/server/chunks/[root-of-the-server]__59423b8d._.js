module.exports=[54799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},54603,e=>{"use strict";e.i(25944),e.s([])},79832,e=>{"use strict";e.i(54603);var t=e.i(25944),r=e.i(98043);async function n(e){let r=await (0,t.getToken)({req:e,secret:process.env.NEXTAUTH_SECRET});return r?.sub||null}async function s(e){if(!e)return null;let n=await (0,t.getToken)({req:e,secret:process.env.NEXTAUTH_SECRET});if(!n?.sub)return null;let s=await r.prisma.user.findUnique({where:{id:n.sub},select:{id:!0,email:!0,name:!0,role:!0,eduVerified:!0}});return s?{user:{id:s.id,email:s.email,name:s.name,role:s.role,eduVerified:s.eduVerified}}:null}async function i(e){let r=await (0,t.getToken)({req:e,secret:process.env.NEXTAUTH_SECRET});return r?.role==="ADMIN"}async function a(){let{headers:t}=await e.A(6878),n=await t(),{getToken:s}=await e.A(21712),i=await s({req:{headers:Object.fromEntries(n.entries())},secret:process.env.NEXTAUTH_SECRET});if(!i?.sub)return null;let a=await r.prisma.user.findUnique({where:{id:i.sub},select:{id:!0,email:!0,name:!0,role:!0,eduVerified:!0}});return a?{user:{id:a.id,email:a.email,name:a.name,role:a.role,eduVerified:a.eduVerified}}:null}function o(e){let t=e.headers.get("x-forwarded-for");if(t)return t.split(",")[0].trim();let r=e.headers.get("x-real-ip");return r||"unknown"}e.s(["getClientIP",()=>o,"getServerSession",()=>a,"getSession",()=>s,"getUserId",()=>n,"isAdmin",()=>i])},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},63021,(e,t,r)=>{t.exports=e.x("@prisma/client-2c3a283f134fdcb6",()=>require("@prisma/client-2c3a283f134fdcb6"))},98043,e=>{"use strict";var t=e.i(63021);let r=globalThis.prisma??new t.PrismaClient({log:["error"]});e.s(["prisma",0,r])},48855,89104,e=>{"use strict";var t=e.i(89171);function r(e,n=200){return t.NextResponse.json({success:!0,data:e},{status:n})}function n(e,r=400,s){return t.NextResponse.json({success:!1,error:e,...s&&{errors:s}},{status:r})}function s(e="Resource not found"){return n(e,404)}function i(e="Unauthorized"){return n(e,401)}function a(e){return t.NextResponse.json({success:!1,error:"Rate limit exceeded",resetAt:new Date(e).toISOString()},{status:429,headers:{"Retry-After":Math.ceil((e-Date.now())/1e3).toString()}})}e.s(["errorResponse",()=>n,"notFoundResponse",()=>s,"rateLimitResponse",()=>a,"successResponse",()=>r,"unauthorizedResponse",()=>i],48855);let o={};function u(e,t){let r=t.keyPrefix?`${t.keyPrefix}:${e}`:e,n=Date.now(),s=o[r];return!s||s.resetAt<n?(s={count:1,resetAt:n+t.windowMs},o[r]=s,{allowed:!0,remaining:t.maxRequests-1,resetAt:s.resetAt}):(s.count++,s.count>t.maxRequests)?{allowed:!1,remaining:0,resetAt:s.resetAt}:{allowed:!0,remaining:t.maxRequests-s.count,resetAt:s.resetAt}}function l(e,t){let r=u(e.headers.get("x-forwarded-for")?.split(",")[0]||"unknown",t);return r.allowed?null:new Response(JSON.stringify({error:"Rate limit exceeded",resetAt:new Date(r.resetAt).toISOString()}),{status:429,headers:{"Content-Type":"application/json","X-RateLimit-Limit":t.maxRequests.toString(),"X-RateLimit-Remaining":r.remaining.toString(),"X-RateLimit-Reset":r.resetAt.toString(),"Retry-After":Math.ceil((r.resetAt-Date.now())/1e3).toString()}})}setInterval(()=>{let e=Date.now();Object.keys(o).forEach(t=>{o[t].resetAt<e&&delete o[t]})},3e5),e.s(["checkRateLimit",()=>u,"rateLimitMiddleware",()=>l],89104)},66545,e=>{"use strict";var t=e.i(69719);let r=t.z.object({query:t.z.string().optional(),page:t.z.coerce.number().int().min(1).default(1),limit:t.z.coerce.number().int().min(1).max(100).default(20)});t.z.object({id:t.z.string().uuid()});let n=t.z.object({id:t.z.string().uuid()}),s=t.z.object({query:t.z.string().optional(),page:t.z.coerce.number().int().min(1).default(1),limit:t.z.coerce.number().int().min(1).max(100).default(20)}),i=t.z.object({ratings:t.z.object({accuracy:t.z.number().int().min(1).max(5),responsiveness:t.z.number().int().min(1).max(5),helpfulness:t.z.number().int().min(1).max(5),availability:t.z.number().int().min(1).max(5),advocacy:t.z.number().int().min(1).max(5),clarity:t.z.number().int().min(1).max(5)}),text:t.z.string().min(50).max(2e3),meetingType:t.z.enum(["in_person","virtual","email","mixed"]),timeframe:t.z.enum(["last_6_months","6_12_months","1_2_years","2_plus_years"]),tags:t.z.array(t.z.string().uuid()).max(5).optional(),email:t.z.string().email().endsWith(".edu").optional(),captchaToken:t.z.string().optional()}),a=t.z.object({id:t.z.string().uuid()});t.z.object({});let o=t.z.object({reason:t.z.enum(["doxxing","hate_speech","off_topic","spam","other"]),details:t.z.string().max(500).optional()}),u=t.z.object({status:t.z.enum(["pending","approved","rejected","reported","flagged","all"]).default("pending"),page:t.z.coerce.number().int().min(1).default(1),limit:t.z.coerce.number().int().min(1).max(100).default(20)}),l=t.z.object({notes:t.z.string().max(1e3).optional()}),c=t.z.object({reason:t.z.string().min(1).max(200),notes:t.z.string().max(1e3).optional()});e.s(["advisorParamsSchema",0,n,"advisorQuerySchema",0,s,"createReviewSchema",0,i,"moderationActionSchema",0,l,"moderationQuerySchema",0,u,"moderationRejectSchema",0,c,"reviewParamsSchema",0,a,"reviewReportSchema",0,o,"universityQuerySchema",0,r])},94293,e=>{"use strict";var t=e.i(54799);let r=["damn","hell","crap","stupid","idiot"],n=["kill","murder","death","harm","hurt","attack","violence","threat","danger","weapon","gun","knife","bomb"],s=[/(.)\1{10,}/gi,/(.)\1{4,}/gi,/[A-Z]{20,}/g,/\d{10,}/g];function i(e){let r=e.headers.get("x-forwarded-for")?.split(",")[0]||"unknown",n=e.headers.get("user-agent")||"",s=e.headers.get("accept-language")||"",i=`${r}:${n}:${s}`;return t.default.createHash("sha256").update(i).digest("hex").substring(0,16)}function a(e){let t=e.toLowerCase();return n.some(e=>t.includes(e))}function o(e){let t,n,i,o,u,l,c,m=[],d=0,p={isSpam:(n=1-new Set(t=e.toLowerCase().split(/\s+/)).size/t.length)>.5,score:n};p.isSpam&&(m.push("Excessive text repetition"),d+=.3);let g=(i=e.match(/https?:\/\/[^\s]+/gi))?i.length:0;g>3&&(m.push(`Too many links (${g})`),d+=.2);let x=(u=(o=e.toLowerCase()).split(/\s+/),l=[],r.forEach(e=>{o.includes(e)&&l.push(e)}),{score:l.length/u.length,words:l});x.score>.3&&(m.push("Excessive profanity"),d+=.3);let h=(c=[],s.forEach(t=>{t.test(e)&&c.push(t.toString())}),{isSpam:c.length>0,patterns:c});h.isSpam&&(m.push("Spam patterns detected"),d+=.2),a(e)&&(m.push("Threats detected"),d+=1);let f=new Set(e.toLowerCase().split(/\s+/));return f.size<10&&(m.push("Too few unique words"),d+=.2),{isSpam:d>=.5||a(e),score:Math.min(d,1),reasons:m,details:{repeatedText:p.score,linkCount:g,profanityScore:x.score,hasSpamPatterns:h.isSpam,hasThreats:a(e),uniqueWordCount:f.size}}}e.s(["detectSpam",()=>o,"generateFingerprint",()=>i])},6878,e=>{e.v(t=>Promise.all(["server/chunks/node_modules_next_f5199d09._.js"].map(t=>e.l(t))).then(()=>t(93458)))},21712,e=>{e.v(t=>Promise.all(["server/chunks/node_modules_next-auth_jwt_9ac8b283.js"].map(t=>e.l(t))).then(()=>t(28833)))},87692,e=>{e.v(e=>Promise.resolve().then(()=>e(79832)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__59423b8d._.js.map