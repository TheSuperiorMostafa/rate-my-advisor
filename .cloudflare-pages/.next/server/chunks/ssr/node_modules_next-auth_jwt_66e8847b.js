module.exports=[7791,69581,a=>{"use strict";let b,c,d;var e,f,g,h,i,j,k=a.i(54799);"function"!=typeof k.hkdf||process.versions.electron||(b=async(...a)=>new Promise((b,c)=>{k.hkdf(...a,(a,d)=>{a?c(a):b(new Uint8Array(d))})}));let l=async(a,c,d,e,f)=>(b||((a,b,c,d,e)=>{let f=parseInt(a.substr(3),10)>>3||20,g=(0,k.createHmac)(a,c.byteLength?c:new Uint8Array(f)).update(b).digest(),h=Math.ceil(e/f),i=new Uint8Array(f*h+d.byteLength+1),j=0,l=0;for(let b=1;b<=h;b++)i.set(d,l),i[l+d.byteLength]=b,i.set((0,k.createHmac)(a,g).update(i.subarray(j,l+d.byteLength+1)).digest(),l),j=l,l+=f;return i.slice(0,e)}))(a,c,d,e,f);function m(a,b){if("string"==typeof a)return new TextEncoder().encode(a);if(!(a instanceof Uint8Array))throw TypeError(`"${b}"" must be an instance of Uint8Array or a string`);return a}async function n(a,b,c,d,e){return l(function(a){switch(a){case"sha256":case"sha384":case"sha512":case"sha1":return a;default:throw TypeError('unsupported "digest" value')}}(a),function(a){let b=m(a,"ikm");if(!b.byteLength)throw TypeError('"ikm" must be at least one byte in length');return b}(b),m(c,"salt"),function(a){let b=m(a,"info");if(b.byteLength>1024)throw TypeError('"info" must not contain more than 1024 bytes');return b}(d),function(a,b){if("number"!=typeof a||!Number.isInteger(a)||a<1)throw TypeError('"keylen" must be a positive integer');if(a>255*(parseInt(b.substr(3),10)>>3||20))throw TypeError('"keylen" too large');return a}(e,a))}let o=new TextEncoder,p=new TextDecoder;function q(...a){let b=new Uint8Array(a.reduce((a,{length:b})=>a+b,0)),c=0;for(let d of a)b.set(d,c),c+=d.length;return b}function r(a,b,c){if(b<0||b>=0x100000000)throw RangeError(`value must be >= 0 and <= ${0x100000000-1}. Received ${b}`);a.set([b>>>24,b>>>16,b>>>8,255&b],c)}function s(a){let b=Math.floor(a/0x100000000),c=new Uint8Array(8);return r(c,b,0),r(c,a%0x100000000,4),c}function t(a){let b=new Uint8Array(4);return r(b,a),b}function u(a){let b=new Uint8Array(a.length);for(let c=0;c<a.length;c++){let d=a.charCodeAt(c);if(d>127)throw TypeError("non-ASCII string encountered in encode()");b[c]=d}return b}function v(a){if(Uint8Array.fromBase64)return Uint8Array.fromBase64("string"==typeof a?a:p.decode(a),{alphabet:"base64url"});let b=a;b instanceof Uint8Array&&(b=p.decode(b)),b=b.replace(/-/g,"+").replace(/_/g,"/");try{var c=b;if(Uint8Array.fromBase64)return Uint8Array.fromBase64(c);let a=atob(c),d=new Uint8Array(a.length);for(let b=0;b<a.length;b++)d[b]=a.charCodeAt(b);return d}catch{throw TypeError("The input to be decoded is not correctly encoded.")}}function w(a){let b=a;return("string"==typeof b&&(b=o.encode(b)),Uint8Array.prototype.toBase64)?b.toBase64({alphabet:"base64url",omitPadding:!0}):(function(a){if(Uint8Array.prototype.toBase64)return a.toBase64();let b=[];for(let c=0;c<a.length;c+=32768)b.push(String.fromCharCode.apply(null,a.subarray(c,c+32768)));return btoa(b.join(""))})(b).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}a.s(["decode",()=>v,"encode",()=>w],9634);let x=Symbol();class y extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(a,b){super(a,b),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class z extends y{static code="ERR_JWT_CLAIM_VALIDATION_FAILED";code="ERR_JWT_CLAIM_VALIDATION_FAILED";claim;reason;payload;constructor(a,b,c="unspecified",d="unspecified"){super(a,{cause:{claim:c,reason:d,payload:b}}),this.claim=c,this.reason=d,this.payload=b}}class A extends y{static code="ERR_JWT_EXPIRED";code="ERR_JWT_EXPIRED";claim;reason;payload;constructor(a,b,c="unspecified",d="unspecified"){super(a,{cause:{claim:c,reason:d,payload:b}}),this.claim=c,this.reason=d,this.payload=b}}class B extends y{static code="ERR_JOSE_ALG_NOT_ALLOWED";code="ERR_JOSE_ALG_NOT_ALLOWED"}class C extends y{static code="ERR_JOSE_NOT_SUPPORTED";code="ERR_JOSE_NOT_SUPPORTED"}class D extends y{static code="ERR_JWE_DECRYPTION_FAILED";code="ERR_JWE_DECRYPTION_FAILED";constructor(a="decryption operation failed",b){super(a,b)}}class E extends y{static code="ERR_JWE_INVALID";code="ERR_JWE_INVALID"}class F extends y{static code="ERR_JWT_INVALID";code="ERR_JWT_INVALID"}class G extends y{static code="ERR_JWK_INVALID";code="ERR_JWK_INVALID"}class H extends y{[Symbol.asyncIterator];static code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";constructor(a="multiple matching keys found in the JSON Web Key Set",b){super(a,b)}}function I(a){switch(a){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new C(`Unsupported JWE Algorithm: ${a}`)}}function J(a,b){if(b.length<<3!==I(a))throw new E("Invalid Initialization Vector length")}function K(a,b){let c=a.byteLength<<3;if(c!==b)throw new E(`Invalid Content Encryption Key length. Expected ${b} bits, got ${c} bits`)}let L=(a,b="algorithm.name")=>TypeError(`CryptoKey does not support this operation, its ${b} must be ${a}`);function M(a,b,c){switch(b){case"A128GCM":case"A192GCM":case"A256GCM":{if("AES-GCM"!==a.algorithm.name)throw L("AES-GCM");let c=parseInt(b.slice(1,4),10);if(a.algorithm.length!==c)throw L(c,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if("AES-KW"!==a.algorithm.name)throw L("AES-KW");let c=parseInt(b.slice(1,4),10);if(a.algorithm.length!==c)throw L(c,"algorithm.length");break}case"ECDH":switch(a.algorithm.name){case"ECDH":case"X25519":break;default:throw L("ECDH or X25519")}break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if("PBKDF2"!==a.algorithm.name)throw L("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if("RSA-OAEP"!==a.algorithm.name)throw L("RSA-OAEP");let c=parseInt(b.slice(9),10)||1;if(parseInt(a.algorithm.hash.name.slice(4),10)!==c)throw L(`SHA-${c}`,"algorithm.hash");break}default:throw TypeError("CryptoKey does not support this operation")}if(c&&!a.usages.includes(c))throw TypeError(`CryptoKey does not support this operation, its usages must include ${c}.`)}function N(a,b,...c){if((c=c.filter(Boolean)).length>2){let b=c.pop();a+=`one of type ${c.join(", ")}, or ${b}.`}else 2===c.length?a+=`one of type ${c[0]} or ${c[1]}.`:a+=`of type ${c[0]}.`;return null==b?a+=` Received ${b}`:"function"==typeof b&&b.name?a+=` Received function ${b.name}`:"object"==typeof b&&null!=b&&b.constructor?.name&&(a+=` Received an instance of ${b.constructor.name}`),a}let O=(a,...b)=>N("Key must be ",a,...b),P=(a,b,...c)=>N(`Key for the ${a} algorithm must be `,b,...c);function Q(a){if(!R(a))throw Error("CryptoKey instance expected")}let R=a=>{if(a?.[Symbol.toStringTag]==="CryptoKey")return!0;try{return a instanceof CryptoKey}catch{return!1}},S=a=>a?.[Symbol.toStringTag]==="KeyObject",T=a=>R(a)||S(a);async function U(a,b,c,d,e){if(!(c instanceof Uint8Array))throw TypeError(O(c,"Uint8Array"));let f=parseInt(a.slice(1,4),10),g=await crypto.subtle.importKey("raw",c.subarray(f>>3),"AES-CBC",!1,["encrypt"]),h=await crypto.subtle.importKey("raw",c.subarray(0,f>>3),{hash:`SHA-${f<<1}`,name:"HMAC"},!1,["sign"]),i=new Uint8Array(await crypto.subtle.encrypt({iv:d,name:"AES-CBC"},g,b)),j=q(e,d,i,s(e.length<<3));return{ciphertext:i,tag:new Uint8Array((await crypto.subtle.sign("HMAC",h,j)).slice(0,f>>3)),iv:d}}async function V(a,b,c,d,e){let f;c instanceof Uint8Array?f=await crypto.subtle.importKey("raw",c,"AES-GCM",!1,["encrypt"]):(M(c,a,"encrypt"),f=c);let g=new Uint8Array(await crypto.subtle.encrypt({additionalData:e,iv:d,name:"AES-GCM",tagLength:128},f,b)),h=g.slice(-16);return{ciphertext:g.slice(0,-16),tag:h,iv:d}}async function W(a,b,c,d,e){if(!R(c)&&!(c instanceof Uint8Array))throw TypeError(O(c,"CryptoKey","KeyObject","Uint8Array","JSON Web Key"));if(d)J(a,d);else d=crypto.getRandomValues(new Uint8Array(I(a)>>3));switch(a){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return c instanceof Uint8Array&&K(c,parseInt(a.slice(-3),10)),U(a,b,c,d,e);case"A128GCM":case"A192GCM":case"A256GCM":return c instanceof Uint8Array&&K(c,parseInt(a.slice(1,4),10)),V(a,b,c,d,e);default:throw new C("Unsupported JWE Content Encryption Algorithm")}}function X(a,b){if(a.algorithm.length!==parseInt(b.slice(1,4),10))throw TypeError(`Invalid key size for alg: ${b}`)}function Y(a,b,c){return a instanceof Uint8Array?crypto.subtle.importKey("raw",a,"AES-KW",!0,[c]):(M(a,b,c),a)}async function Z(a,b,c){let d=await Y(b,a,"wrapKey");X(d,a);let e=await crypto.subtle.importKey("raw",c,{hash:"SHA-256",name:"HMAC"},!0,["sign"]);return new Uint8Array(await crypto.subtle.wrapKey("raw",e,d,"AES-KW"))}async function $(a,b,c){let d=await Y(b,a,"unwrapKey");X(d,a);let e=await crypto.subtle.unwrapKey("raw",c,d,"AES-KW",{hash:"SHA-256",name:"HMAC"},!0,["sign"]);return new Uint8Array(await crypto.subtle.exportKey("raw",e))}async function _(a,b){let c=`SHA-${a.slice(-3)}`;return new Uint8Array(await crypto.subtle.digest(c,b))}function aa(a){return q(t(a.length),a)}async function ab(a,b,c){let d=b>>3,e=Math.ceil(d/32),f=new Uint8Array(32*e);for(let b=1;b<=e;b++){let d=new Uint8Array(4+a.length+c.length);d.set(t(b),0),d.set(a,4),d.set(c,4+a.length);let e=await _("sha256",d);f.set(e,(b-1)*32)}return f.slice(0,d)}async function ac(a,b,c,d,e=new Uint8Array,f=new Uint8Array){var g;M(a,"ECDH"),M(b,"ECDH","deriveBits");let h=q(aa(u(c)),aa(e),aa(f),t(d),new Uint8Array);return ab(new Uint8Array(await crypto.subtle.deriveBits({name:a.algorithm.name,public:a},b,"X25519"===(g=a).algorithm.name?256:Math.ceil(parseInt(g.algorithm.namedCurve.slice(-3),10)/8)<<3)),d,h)}function ad(a){switch(a.algorithm.namedCurve){case"P-256":case"P-384":case"P-521":return!0;default:return"X25519"===a.algorithm.name}}async function ae(a,b,c,d){if(!(a instanceof Uint8Array)||a.length<8)throw new E("PBES2 Salt Input must be 8 or more octets");let e=q(u(b),Uint8Array.of(0),a),f=parseInt(b.slice(13,16),10),g={hash:`SHA-${b.slice(8,11)}`,iterations:c,name:"PBKDF2",salt:e},h=await (d instanceof Uint8Array?crypto.subtle.importKey("raw",d,"PBKDF2",!1,["deriveBits"]):(M(d,b,"deriveBits"),d));return new Uint8Array(await crypto.subtle.deriveBits(g,h,f))}async function af(a,b,c,d=2048,e=crypto.getRandomValues(new Uint8Array(16))){let f=await ae(e,a,d,b);return{encryptedKey:await Z(a.slice(-6),f,c),p2c:d,p2s:w(e)}}async function ag(a,b,c,d,e){let f=await ae(e,a,d,b);return $(a.slice(-6),f,c)}function ah(a,b){if(a.startsWith("RS")||a.startsWith("PS")){let{modulusLength:c}=b.algorithm;if("number"!=typeof c||c<2048)throw TypeError(`${a} requires key modulusLength to be 2048 bits or larger`)}}let ai=a=>{switch(a){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return"RSA-OAEP";default:throw new C(`alg ${a} is not supported either by JOSE or your javascript runtime`)}};async function aj(a,b,c){return M(b,a,"encrypt"),ah(a,b),new Uint8Array(await crypto.subtle.encrypt(ai(a),b,c))}async function ak(a,b,c){return M(b,a,"decrypt"),ah(a,b),new Uint8Array(await crypto.subtle.decrypt(ai(a),b,c))}function al(a){if("object"!=typeof a||null===a||"[object Object]"!==Object.prototype.toString.call(a))return!1;if(null===Object.getPrototypeOf(a))return!0;let b=a;for(;null!==Object.getPrototypeOf(b);)b=Object.getPrototypeOf(b);return Object.getPrototypeOf(a)===b}let am=a=>al(a)&&"string"==typeof a.kty;async function an(a){if(!a.alg)throw TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:b,keyUsages:c}=function(a){let b,c;switch(a.kty){case"AKP":switch(a.alg){case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":b={name:a.alg},c=a.priv?["sign"]:["verify"];break;default:throw new C('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"RSA":switch(a.alg){case"PS256":case"PS384":case"PS512":b={name:"RSA-PSS",hash:`SHA-${a.alg.slice(-3)}`},c=a.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":b={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${a.alg.slice(-3)}`},c=a.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":b={name:"RSA-OAEP",hash:`SHA-${parseInt(a.alg.slice(-3),10)||1}`},c=a.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new C('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(a.alg){case"ES256":b={name:"ECDSA",namedCurve:"P-256"},c=a.d?["sign"]:["verify"];break;case"ES384":b={name:"ECDSA",namedCurve:"P-384"},c=a.d?["sign"]:["verify"];break;case"ES512":b={name:"ECDSA",namedCurve:"P-521"},c=a.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":b={name:"ECDH",namedCurve:a.crv},c=a.d?["deriveBits"]:[];break;default:throw new C('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(a.alg){case"Ed25519":case"EdDSA":b={name:"Ed25519"},c=a.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":b={name:a.crv},c=a.d?["deriveBits"]:[];break;default:throw new C('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new C('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:b,keyUsages:c}}(a),d={...a};return"AKP"!==d.kty&&delete d.alg,delete d.use,crypto.subtle.importKey("jwk",d,b,a.ext??(!a.d&&!a.priv),a.key_ops??c)}let ao=async(a,b,d,e=!1)=>{let f=(c||=new WeakMap).get(a);if(f?.[d])return f[d];let g=await an({...b,alg:d});return e&&Object.freeze(a),f?f[d]=g:c.set(a,{[d]:g}),g};async function ap(a,b){if(a instanceof Uint8Array||R(a))return a;if(S(a)){if("secret"===a.type)return a.export();if("toCryptoKey"in a&&"function"==typeof a.toCryptoKey)try{return((a,b)=>{let d,e=(c||=new WeakMap).get(a);if(e?.[b])return e[b];let f="public"===a.type,g=!!f;if("x25519"===a.asymmetricKeyType){switch(b){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}d=a.toCryptoKey(a.asymmetricKeyType,g,f?[]:["deriveBits"])}if("ed25519"===a.asymmetricKeyType){if("EdDSA"!==b&&"Ed25519"!==b)throw TypeError("given KeyObject instance cannot be used for this algorithm");d=a.toCryptoKey(a.asymmetricKeyType,g,[f?"verify":"sign"])}switch(a.asymmetricKeyType){case"ml-dsa-44":case"ml-dsa-65":case"ml-dsa-87":if(b!==a.asymmetricKeyType.toUpperCase())throw TypeError("given KeyObject instance cannot be used for this algorithm");d=a.toCryptoKey(a.asymmetricKeyType,g,[f?"verify":"sign"])}if("rsa"===a.asymmetricKeyType){let c;switch(b){case"RSA-OAEP":c="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":c="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":c="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":c="SHA-512";break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}if(b.startsWith("RSA-OAEP"))return a.toCryptoKey({name:"RSA-OAEP",hash:c},g,f?["encrypt"]:["decrypt"]);d=a.toCryptoKey({name:b.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:c},g,[f?"verify":"sign"])}if("ec"===a.asymmetricKeyType){let c=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get(a.asymmetricKeyDetails?.namedCurve);if(!c)throw TypeError("given KeyObject instance cannot be used for this algorithm");"ES256"===b&&"P-256"===c&&(d=a.toCryptoKey({name:"ECDSA",namedCurve:c},g,[f?"verify":"sign"])),"ES384"===b&&"P-384"===c&&(d=a.toCryptoKey({name:"ECDSA",namedCurve:c},g,[f?"verify":"sign"])),"ES512"===b&&"P-521"===c&&(d=a.toCryptoKey({name:"ECDSA",namedCurve:c},g,[f?"verify":"sign"])),b.startsWith("ECDH-ES")&&(d=a.toCryptoKey({name:"ECDH",namedCurve:c},g,f?[]:["deriveBits"]))}if(!d)throw TypeError("given KeyObject instance cannot be used for this algorithm");return e?e[b]=d:c.set(a,{[b]:d}),d})(a,b)}catch(a){if(a instanceof TypeError)throw a}let d=a.export({format:"jwk"});return ao(a,d,b)}if(am(a))return a.k?v(a.k):ao(a,a,b,!0);throw Error("unreachable")}function aq(a){switch(a){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new C(`Unsupported JWE Algorithm: ${a}`)}}let ar=a=>crypto.getRandomValues(new Uint8Array(aq(a)>>3));async function as(a){if(S(a))if("secret"!==a.type)return a.export({format:"jwk"});else a=a.export();if(a instanceof Uint8Array)return{kty:"oct",k:w(a)};if(!R(a))throw TypeError(O(a,"CryptoKey","KeyObject","Uint8Array"));if(!a.extractable)throw TypeError("non-extractable CryptoKey cannot be exported as a JWK");let{ext:b,key_ops:c,alg:d,use:e,...f}=await crypto.subtle.exportKey("jwk",a);return"AKP"===f.kty&&(f.alg=d),f}async function at(a){return as(a)}async function au(a,b){if(!(a instanceof Uint8Array))throw TypeError("First argument must be a buffer");if(!(b instanceof Uint8Array))throw TypeError("Second argument must be a buffer");let c={name:"HMAC",hash:"SHA-256"},d=await crypto.subtle.generateKey(c,!1,["sign"]),e=new Uint8Array(await crypto.subtle.sign(c,d,a)),f=new Uint8Array(await crypto.subtle.sign(c,d,b)),g=0,h=-1;for(;++h<32;)g|=e[h]^f[h];return 0===g}async function av(a,b,c,d,e,f){let g,h;if(!(b instanceof Uint8Array))throw TypeError(O(b,"Uint8Array"));let i=parseInt(a.slice(1,4),10),j=await crypto.subtle.importKey("raw",b.subarray(i>>3),"AES-CBC",!1,["decrypt"]),k=await crypto.subtle.importKey("raw",b.subarray(0,i>>3),{hash:`SHA-${i<<1}`,name:"HMAC"},!1,["sign"]),l=q(f,d,c,s(f.length<<3)),m=new Uint8Array((await crypto.subtle.sign("HMAC",k,l)).slice(0,i>>3));try{g=await au(e,m)}catch{}if(!g)throw new D;try{h=new Uint8Array(await crypto.subtle.decrypt({iv:d,name:"AES-CBC"},j,c))}catch{}if(!h)throw new D;return h}async function aw(a,b,c,d,e,f){let g;b instanceof Uint8Array?g=await crypto.subtle.importKey("raw",b,"AES-GCM",!1,["decrypt"]):(M(b,a,"decrypt"),g=b);try{return new Uint8Array(await crypto.subtle.decrypt({additionalData:f,iv:d,name:"AES-GCM",tagLength:128},g,q(c,e)))}catch{throw new D}}async function ax(a,b,c,d,e,f){if(!R(b)&&!(b instanceof Uint8Array))throw TypeError(O(b,"CryptoKey","KeyObject","Uint8Array","JSON Web Key"));if(!d)throw new E("JWE Initialization Vector missing");if(!e)throw new E("JWE Authentication Tag missing");switch(J(a,d),a){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return b instanceof Uint8Array&&K(b,parseInt(a.slice(-3),10)),av(a,b,c,d,e,f);case"A128GCM":case"A192GCM":case"A256GCM":return b instanceof Uint8Array&&K(b,parseInt(a.slice(1,4),10)),aw(a,b,c,d,e,f);default:throw new C("Unsupported JWE Content Encryption Algorithm")}}async function ay(a,b,c,d){let e=a.slice(0,7),f=await W(e,c,b,d,new Uint8Array);return{encryptedKey:f.ciphertext,iv:w(f.iv),tag:w(f.tag)}}async function az(a,b,c,d,e){return ax(a.slice(0,7),b,c,d,e,new Uint8Array)}async function aA(a,b,c,d,e={}){let f,g,h;switch(a){case"dir":h=c;break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let i;if(Q(c),!ad(c))throw new C("ECDH with the provided key is not allowed or not supported by your javascript runtime");let{apu:j,apv:k}=e;i=e.epk?await ap(e.epk,a):(await crypto.subtle.generateKey(c.algorithm,!0,["deriveBits"])).privateKey;let{x:l,y:m,crv:n,kty:o}=await at(i),p=await ac(c,i,"ECDH-ES"===a?b:a,"ECDH-ES"===a?aq(b):parseInt(a.slice(-5,-2),10),j,k);if(g={epk:{x:l,crv:n,kty:o}},"EC"===o&&(g.epk.y=m),j&&(g.apu=w(j)),k&&(g.apv=w(k)),"ECDH-ES"===a){h=p;break}h=d||ar(b);let q=a.slice(-6);f=await Z(q,p,h);break}case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":h=d||ar(b),Q(c),f=await aj(a,c,h);break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{h=d||ar(b);let{p2c:i,p2s:j}=e;({encryptedKey:f,...g}=await af(a,c,h,i,j));break}case"A128KW":case"A192KW":case"A256KW":h=d||ar(b),f=await Z(a,c,h);break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{h=d||ar(b);let{iv:i}=e;({encryptedKey:f,...g}=await ay(a,c,h,i));break}default:throw new C('Invalid or unsupported "alg" (JWE Algorithm) header value')}return{cek:h,encryptedKey:f,parameters:g}}function aB(...a){let b,c=a.filter(Boolean);if(0===c.length||1===c.length)return!0;for(let a of c){let c=Object.keys(a);if(!b||0===b.size){b=new Set(c);continue}for(let a of c){if(b.has(a))return!1;b.add(a)}}return!0}function aC(a,b,c,d,e){let f;if(void 0!==e.crit&&d?.crit===void 0)throw new a('"crit" (Critical) Header Parameter MUST be integrity protected');if(!d||void 0===d.crit)return new Set;if(!Array.isArray(d.crit)||0===d.crit.length||d.crit.some(a=>"string"!=typeof a||0===a.length))throw new a('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let g of(f=void 0!==c?new Map([...Object.entries(c),...b.entries()]):b,d.crit)){if(!f.has(g))throw new C(`Extension Header Parameter "${g}" is not recognized`);if(void 0===e[g])throw new a(`Extension Header Parameter "${g}" is missing`);if(f.get(g)&&void 0===d[g])throw new a(`Extension Header Parameter "${g}" MUST be integrity protected`)}return new Set(d.crit)}let aD=a=>a?.[Symbol.toStringTag],aE=(a,b,c)=>{if(void 0!==b.use){let a;switch(c){case"sign":case"verify":a="sig";break;case"encrypt":case"decrypt":a="enc"}if(b.use!==a)throw TypeError(`Invalid key for this operation, its "use" must be "${a}" when present`)}if(void 0!==b.alg&&b.alg!==a)throw TypeError(`Invalid key for this operation, its "alg" must be "${a}" when present`);if(Array.isArray(b.key_ops)){let d;switch(!0){case"sign"===c||"verify"===c:case"dir"===a:case a.includes("CBC-HS"):d=c;break;case a.startsWith("PBES2"):d="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(a):d=!a.includes("GCM")&&a.endsWith("KW")?"encrypt"===c?"wrapKey":"unwrapKey":c;break;case"encrypt"===c&&a.startsWith("RSA"):d="wrapKey";break;case"decrypt"===c:d=a.startsWith("RSA")?"unwrapKey":"deriveBits"}if(d&&b.key_ops?.includes?.(d)===!1)throw TypeError(`Invalid key for this operation, its "key_ops" must include "${d}" when present`)}return!0};function aF(a,b,c){switch(a.substring(0,2)){case"A1":case"A2":case"di":case"HS":case"PB":((a,b,c)=>{if(!(b instanceof Uint8Array)){if(am(b)){if("oct"===b.kty&&"string"==typeof b.k&&aE(a,b,c))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!T(b))throw TypeError(P(a,b,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if("secret"!==b.type)throw TypeError(`${aD(b)} instances for symmetric algorithms must be of type "secret"`)}})(a,b,c);break;default:((a,b,c)=>{if(am(b))switch(c){case"decrypt":case"sign":if("oct"!==b.kty&&("AKP"===b.kty&&"string"==typeof b.priv||"string"==typeof b.d)&&aE(a,b,c))return;throw TypeError("JSON Web Key for this operation must be a private JWK");case"encrypt":case"verify":if("oct"!==b.kty&&void 0===b.d&&void 0===b.priv&&aE(a,b,c))return;throw TypeError("JSON Web Key for this operation must be a public JWK")}if(!T(b))throw TypeError(P(a,b,"CryptoKey","KeyObject","JSON Web Key"));if("secret"===b.type)throw TypeError(`${aD(b)} instances for asymmetric algorithms must not be of type "secret"`);if("public"===b.type)switch(c){case"sign":throw TypeError(`${aD(b)} instances for asymmetric algorithm signing must be of type "private"`);case"decrypt":throw TypeError(`${aD(b)} instances for asymmetric algorithm decryption must be of type "private"`)}if("private"===b.type)switch(c){case"verify":throw TypeError(`${aD(b)} instances for asymmetric algorithm verifying must be of type "public"`);case"encrypt":throw TypeError(`${aD(b)} instances for asymmetric algorithm encryption must be of type "public"`)}})(a,b,c)}}class aG{#a;#b;#c;#d;#e;#f;#g;#h;constructor(a){if(!(a instanceof Uint8Array))throw TypeError("plaintext must be an instance of Uint8Array");this.#a=a}setKeyManagementParameters(a){if(this.#h)throw TypeError("setKeyManagementParameters can only be called once");return this.#h=a,this}setProtectedHeader(a){if(this.#b)throw TypeError("setProtectedHeader can only be called once");return this.#b=a,this}setSharedUnprotectedHeader(a){if(this.#c)throw TypeError("setSharedUnprotectedHeader can only be called once");return this.#c=a,this}setUnprotectedHeader(a){if(this.#d)throw TypeError("setUnprotectedHeader can only be called once");return this.#d=a,this}setAdditionalAuthenticatedData(a){return this.#e=a,this}setContentEncryptionKey(a){if(this.#f)throw TypeError("setContentEncryptionKey can only be called once");return this.#f=a,this}setInitializationVector(a){if(this.#g)throw TypeError("setInitializationVector can only be called once");return this.#g=a,this}async encrypt(a,b){let c,d,e,f,g,h;if(!this.#b&&!this.#d&&!this.#c)throw new E("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!aB(this.#b,this.#d,this.#c))throw new E("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let i={...this.#b,...this.#d,...this.#c};if(aC(E,new Map,b?.crit,this.#b,i),void 0!==i.zip)throw new C('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');let{alg:j,enc:k}=i;if("string"!=typeof j||!j)throw new E('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("string"!=typeof k||!k)throw new E('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(this.#f&&("dir"===j||"ECDH-ES"===j))throw TypeError(`setContentEncryptionKey cannot be called with JWE "alg" (Algorithm) Header ${j}`);aF("dir"===j?k:j,a,"encrypt");{let e,f=await ap(a,j);({cek:d,encryptedKey:c,parameters:e}=await aA(j,k,f,this.#f,this.#h)),e&&(b&&x in b?this.#d?this.#d={...this.#d,...e}:this.setUnprotectedHeader(e):this.#b?this.#b={...this.#b,...e}:this.setProtectedHeader(e))}if(this.#b?g=u(f=w(JSON.stringify(this.#b))):(f="",g=new Uint8Array),this.#e){let a=u(h=w(this.#e));e=q(g,u("."),a)}else e=g;let{ciphertext:l,tag:m,iv:n}=await W(k,this.#a,d,this.#g,e),o={ciphertext:w(l)};return n&&(o.iv=w(n)),m&&(o.tag=w(m)),c&&(o.encrypted_key=w(c)),h&&(o.aad=h),this.#b&&(o.protected=f),this.#c&&(o.unprotected=this.#c),this.#d&&(o.header=this.#d),o}}class aH{#i;constructor(a){this.#i=new aG(a)}setContentEncryptionKey(a){return this.#i.setContentEncryptionKey(a),this}setInitializationVector(a){return this.#i.setInitializationVector(a),this}setProtectedHeader(a){return this.#i.setProtectedHeader(a),this}setKeyManagementParameters(a){return this.#i.setKeyManagementParameters(a),this}async encrypt(a,b){let c=await this.#i.encrypt(a,b);return[c.protected,c.encrypted_key,c.iv,c.ciphertext,c.tag].join(".")}}let aI=a=>Math.floor(a.getTime()/1e3),aJ=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;function aK(a){let b,c=aJ.exec(a);if(!c||c[4]&&c[1])throw TypeError("Invalid time period format");let d=parseFloat(c[2]);switch(c[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":b=Math.round(d);break;case"minute":case"minutes":case"min":case"mins":case"m":b=Math.round(60*d);break;case"hour":case"hours":case"hr":case"hrs":case"h":b=Math.round(3600*d);break;case"day":case"days":case"d":b=Math.round(86400*d);break;case"week":case"weeks":case"w":b=Math.round(604800*d);break;default:b=Math.round(0x1e187e0*d)}return"-"===c[1]||"ago"===c[4]?-b:b}function aL(a,b){if(!Number.isFinite(b))throw TypeError(`Invalid ${a} input`);return b}let aM=a=>a.includes("/")?a.toLowerCase():`application/${a.toLowerCase()}`;class aN{#j;constructor(a){if(!al(a))throw TypeError("JWT Claims Set MUST be an object");this.#j=structuredClone(a)}data(){return o.encode(JSON.stringify(this.#j))}get iss(){return this.#j.iss}set iss(a){this.#j.iss=a}get sub(){return this.#j.sub}set sub(a){this.#j.sub=a}get aud(){return this.#j.aud}set aud(a){this.#j.aud=a}set jti(a){this.#j.jti=a}set nbf(a){"number"==typeof a?this.#j.nbf=aL("setNotBefore",a):a instanceof Date?this.#j.nbf=aL("setNotBefore",aI(a)):this.#j.nbf=aI(new Date)+aK(a)}set exp(a){"number"==typeof a?this.#j.exp=aL("setExpirationTime",a):a instanceof Date?this.#j.exp=aL("setExpirationTime",aI(a)):this.#j.exp=aI(new Date)+aK(a)}set iat(a){void 0===a?this.#j.iat=aI(new Date):a instanceof Date?this.#j.iat=aL("setIssuedAt",aI(a)):"string"==typeof a?this.#j.iat=aL("setIssuedAt",aI(new Date)+aK(a)):this.#j.iat=aL("setIssuedAt",a)}}class aO{#f;#g;#h;#b;#k;#l;#m;#n;constructor(a={}){this.#n=new aN(a)}setIssuer(a){return this.#n.iss=a,this}setSubject(a){return this.#n.sub=a,this}setAudience(a){return this.#n.aud=a,this}setJti(a){return this.#n.jti=a,this}setNotBefore(a){return this.#n.nbf=a,this}setExpirationTime(a){return this.#n.exp=a,this}setIssuedAt(a){return this.#n.iat=a,this}setProtectedHeader(a){if(this.#b)throw TypeError("setProtectedHeader can only be called once");return this.#b=a,this}setKeyManagementParameters(a){if(this.#h)throw TypeError("setKeyManagementParameters can only be called once");return this.#h=a,this}setContentEncryptionKey(a){if(this.#f)throw TypeError("setContentEncryptionKey can only be called once");return this.#f=a,this}setInitializationVector(a){if(this.#g)throw TypeError("setInitializationVector can only be called once");return this.#g=a,this}replicateIssuerAsHeader(){return this.#k=!0,this}replicateSubjectAsHeader(){return this.#l=!0,this}replicateAudienceAsHeader(){return this.#m=!0,this}async encrypt(a,b){let c=new aH(this.#n.data());return this.#b&&(this.#k||this.#l||this.#m)&&(this.#b={...this.#b,iss:this.#k?this.#n.iss:void 0,sub:this.#l?this.#n.sub:void 0,aud:this.#m?this.#n.aud:void 0}),c.setProtectedHeader(this.#b),this.#g&&c.setInitializationVector(this.#g),this.#f&&c.setContentEncryptionKey(this.#f),this.#h&&c.setKeyManagementParameters(this.#h),c.encrypt(a,b)}}var aP=a.i(9634),aP=aP;let aQ=(a,b)=>{if("string"!=typeof a||!a)throw new G(`${b} missing or invalid`)};async function aR(a,b){let c,d;if(am(a))c=a;else if(T(a))c=await at(a);else throw TypeError(O(a,"CryptoKey","KeyObject","JSON Web Key"));if("sha256"!==(b??="sha256")&&"sha384"!==b&&"sha512"!==b)throw TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');switch(c.kty){case"AKP":aQ(c.alg,'"alg" (Algorithm) Parameter'),aQ(c.pub,'"pub" (Public key) Parameter'),d={alg:c.alg,kty:c.kty,pub:c.pub};break;case"EC":aQ(c.crv,'"crv" (Curve) Parameter'),aQ(c.x,'"x" (X Coordinate) Parameter'),aQ(c.y,'"y" (Y Coordinate) Parameter'),d={crv:c.crv,kty:c.kty,x:c.x,y:c.y};break;case"OKP":aQ(c.crv,'"crv" (Subtype of Key Pair) Parameter'),aQ(c.x,'"x" (Public Key) Parameter'),d={crv:c.crv,kty:c.kty,x:c.x};break;case"RSA":aQ(c.e,'"e" (Exponent) Parameter'),aQ(c.n,'"n" (Modulus) Parameter'),d={e:c.e,kty:c.kty,n:c.n};break;case"oct":aQ(c.k,'"k" (Key Value) Parameter'),d={k:c.k,kty:c.kty};break;default:throw new C('"kty" (Key Type) Parameter missing or unsupported')}let e=u(JSON.stringify(d));return w(await _(b,e))}async function aS(a,b,c){let d;if(!al(a))throw TypeError("JWK must be an object");switch(b??=a.alg,d??=c?.extractable??a.ext,a.kty){case"oct":if("string"!=typeof a.k||!a.k)throw TypeError('missing "k" (Key Value) Parameter value');return v(a.k);case"RSA":if("oth"in a&&void 0!==a.oth)throw new C('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');return an({...a,alg:b,ext:d});case"AKP":if("string"!=typeof a.alg||!a.alg)throw TypeError('missing "alg" (Algorithm) Parameter value');if(void 0!==b&&b!==a.alg)throw TypeError("JWK alg and alg option value mismatch");return an({...a,ext:d});case"EC":case"OKP":return an({...a,alg:b,ext:d});default:throw new C('Unsupported "kty" (Key Type) Parameter value')}}async function aT(a,b,c,d,e){switch(a){case"dir":if(void 0!==c)throw new E("Encountered unexpected JWE Encrypted Key");return b;case"ECDH-ES":if(void 0!==c)throw new E("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let e,f;if(!al(d.epk))throw new E('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(Q(b),!ad(b))throw new C("ECDH with the provided key is not allowed or not supported by your javascript runtime");let g=await aS(d.epk,a);if(Q(g),void 0!==d.apu){if("string"!=typeof d.apu)throw new E('JOSE Header "apu" (Agreement PartyUInfo) invalid');try{e=v(d.apu)}catch{throw new E("Failed to base64url decode the apu")}}if(void 0!==d.apv){if("string"!=typeof d.apv)throw new E('JOSE Header "apv" (Agreement PartyVInfo) invalid');try{f=v(d.apv)}catch{throw new E("Failed to base64url decode the apv")}}let h=await ac(g,b,"ECDH-ES"===a?d.enc:a,"ECDH-ES"===a?aq(d.enc):parseInt(a.slice(-5,-2),10),e,f);if("ECDH-ES"===a)return h;if(void 0===c)throw new E("JWE Encrypted Key missing");return $(a.slice(-6),h,c)}case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":if(void 0===c)throw new E("JWE Encrypted Key missing");return Q(b),ak(a,b,c);case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{let f;if(void 0===c)throw new E("JWE Encrypted Key missing");if("number"!=typeof d.p2c)throw new E('JOSE Header "p2c" (PBES2 Count) missing or invalid');let g=e?.maxPBES2Count||1e4;if(d.p2c>g)throw new E('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if("string"!=typeof d.p2s)throw new E('JOSE Header "p2s" (PBES2 Salt) missing or invalid');try{f=v(d.p2s)}catch{throw new E("Failed to base64url decode the p2s")}return ag(a,b,c,d.p2c,f)}case"A128KW":case"A192KW":case"A256KW":if(void 0===c)throw new E("JWE Encrypted Key missing");return $(a,b,c);case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{let e,f;if(void 0===c)throw new E("JWE Encrypted Key missing");if("string"!=typeof d.iv)throw new E('JOSE Header "iv" (Initialization Vector) missing or invalid');if("string"!=typeof d.tag)throw new E('JOSE Header "tag" (Authentication Tag) missing or invalid');try{e=v(d.iv)}catch{throw new E("Failed to base64url decode the iv")}try{f=v(d.tag)}catch{throw new E("Failed to base64url decode the tag")}return az(a,b,c,e,f)}default:throw new C('Invalid or unsupported "alg" (JWE Algorithm) header value')}}function aU(a,b){if(void 0!==b&&(!Array.isArray(b)||b.some(a=>"string"!=typeof a)))throw TypeError(`"${a}" option must be an array of strings`);if(b)return new Set(b)}async function aV(a,b,c){let d,e,f,g,h,i,j;if(!al(a))throw new E("Flattened JWE must be an object");if(void 0===a.protected&&void 0===a.header&&void 0===a.unprotected)throw new E("JOSE Header missing");if(void 0!==a.iv&&"string"!=typeof a.iv)throw new E("JWE Initialization Vector incorrect type");if("string"!=typeof a.ciphertext)throw new E("JWE Ciphertext missing or incorrect type");if(void 0!==a.tag&&"string"!=typeof a.tag)throw new E("JWE Authentication Tag incorrect type");if(void 0!==a.protected&&"string"!=typeof a.protected)throw new E("JWE Protected Header incorrect type");if(void 0!==a.encrypted_key&&"string"!=typeof a.encrypted_key)throw new E("JWE Encrypted Key incorrect type");if(void 0!==a.aad&&"string"!=typeof a.aad)throw new E("JWE AAD incorrect type");if(void 0!==a.header&&!al(a.header))throw new E("JWE Shared Unprotected Header incorrect type");if(void 0!==a.unprotected&&!al(a.unprotected))throw new E("JWE Per-Recipient Unprotected Header incorrect type");if(a.protected)try{let b=v(a.protected);d=JSON.parse(p.decode(b))}catch{throw new E("JWE Protected Header is invalid")}if(!aB(d,a.header,a.unprotected))throw new E("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");let k={...d,...a.header,...a.unprotected};if(aC(E,new Map,c?.crit,d,k),void 0!==k.zip)throw new C('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');let{alg:l,enc:m}=k;if("string"!=typeof l||!l)throw new E("missing JWE Algorithm (alg) in JWE Header");if("string"!=typeof m||!m)throw new E("missing JWE Encryption Algorithm (enc) in JWE Header");let n=c&&aU("keyManagementAlgorithms",c.keyManagementAlgorithms),o=c&&aU("contentEncryptionAlgorithms",c.contentEncryptionAlgorithms);if(n&&!n.has(l)||!n&&l.startsWith("PBES2"))throw new B('"alg" (Algorithm) Header Parameter value not allowed');if(o&&!o.has(m))throw new B('"enc" (Encryption Algorithm) Header Parameter value not allowed');if(void 0!==a.encrypted_key)try{e=v(a.encrypted_key)}catch{throw new E("Failed to base64url decode the encrypted_key")}let r=!1;"function"==typeof b&&(b=await b(d,a),r=!0),aF("dir"===l?m:l,b,"decrypt");let s=await ap(b,l);try{f=await aT(l,s,e,k,c)}catch(a){if(a instanceof TypeError||a instanceof E||a instanceof C)throw a;f=ar(m)}if(void 0!==a.iv)try{g=v(a.iv)}catch{throw new E("Failed to base64url decode the iv")}if(void 0!==a.tag)try{h=v(a.tag)}catch{throw new E("Failed to base64url decode the tag")}let t=void 0!==a.protected?u(a.protected):new Uint8Array;i=void 0!==a.aad?q(t,u("."),u(a.aad)):t;try{j=v(a.ciphertext)}catch{throw new E("Failed to base64url decode the ciphertext")}let w={plaintext:await ax(m,f,j,g,h,i)};if(void 0!==a.protected&&(w.protectedHeader=d),void 0!==a.aad)try{w.additionalAuthenticatedData=v(a.aad)}catch{throw new E("Failed to base64url decode the aad")}return(void 0!==a.unprotected&&(w.sharedUnprotectedHeader=a.unprotected),void 0!==a.header&&(w.unprotectedHeader=a.header),r)?{...w,key:s}:w}async function aW(a,b,c){if(a instanceof Uint8Array&&(a=p.decode(a)),"string"!=typeof a)throw new E("Compact JWE must be a string or Uint8Array");let{0:d,1:e,2:f,3:g,4:h,length:i}=a.split(".");if(5!==i)throw new E("Invalid Compact JWE");let j=await aV({ciphertext:g,iv:f||void 0,protected:d,tag:h||void 0,encrypted_key:e||void 0},b,c),k={plaintext:j.plaintext,protectedHeader:j.protectedHeader};return"function"==typeof b?{...k,key:j.key}:k}async function aX(a,b,c){let d=await aW(a,b,c),e=function(a,b,c={}){var d,e;let f,g;try{f=JSON.parse(p.decode(b))}catch{}if(!al(f))throw new F("JWT Claims Set must be a top-level JSON object");let{typ:h}=c;if(h&&("string"!=typeof a.typ||aM(a.typ)!==aM(h)))throw new z('unexpected "typ" JWT header value',f,"typ","check_failed");let{requiredClaims:i=[],issuer:j,subject:k,audience:l,maxTokenAge:m}=c,n=[...i];for(let a of(void 0!==m&&n.push("iat"),void 0!==l&&n.push("aud"),void 0!==k&&n.push("sub"),void 0!==j&&n.push("iss"),new Set(n.reverse())))if(!(a in f))throw new z(`missing required "${a}" claim`,f,a,"missing");if(j&&!(Array.isArray(j)?j:[j]).includes(f.iss))throw new z('unexpected "iss" claim value',f,"iss","check_failed");if(k&&f.sub!==k)throw new z('unexpected "sub" claim value',f,"sub","check_failed");if(l&&(d=f.aud,e="string"==typeof l?[l]:l,"string"==typeof d?!e.includes(d):!(Array.isArray(d)&&e.some(Set.prototype.has.bind(new Set(d))))))throw new z('unexpected "aud" claim value',f,"aud","check_failed");switch(typeof c.clockTolerance){case"string":g=aK(c.clockTolerance);break;case"number":g=c.clockTolerance;break;case"undefined":g=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:o}=c,q=aI(o||new Date);if((void 0!==f.iat||m)&&"number"!=typeof f.iat)throw new z('"iat" claim must be a number',f,"iat","invalid");if(void 0!==f.nbf){if("number"!=typeof f.nbf)throw new z('"nbf" claim must be a number',f,"nbf","invalid");if(f.nbf>q+g)throw new z('"nbf" claim timestamp check failed',f,"nbf","check_failed")}if(void 0!==f.exp){if("number"!=typeof f.exp)throw new z('"exp" claim must be a number',f,"exp","invalid");if(f.exp<=q-g)throw new A('"exp" claim timestamp check failed',f,"exp","check_failed")}if(m){let a=q-f.iat;if(a-g>("number"==typeof m?m:aK(m)))throw new A('"iat" claim timestamp check failed (too far in the past)',f,"iat","check_failed");if(a<0-g)throw new z('"iat" claim timestamp check failed (it should be in the past)',f,"iat","check_failed")}return f}(d.protectedHeader,d.plaintext,c),{protectedHeader:f}=d;if(void 0!==f.iss&&f.iss!==e.iss)throw new z('replicated "iss" claim header parameter mismatch',e,"iss","mismatch");if(void 0!==f.sub&&f.sub!==e.sub)throw new z('replicated "sub" claim header parameter mismatch',e,"sub","mismatch");if(void 0!==f.aud&&JSON.stringify(f.aud)!==JSON.stringify(e.aud))throw new z('replicated "aud" claim header parameter mismatch',e,"aud","mismatch");let g={payload:e,protectedHeader:f};return"function"==typeof b?{...g,key:d.key}:g}var aY=function(a,b,c,d,e){if("m"===d)throw TypeError("Private method is not writable");if("a"===d&&!e)throw TypeError("Private accessor was defined without a setter");if("function"==typeof b?a!==b||!e:!b.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===d?e.call(a,c):e?e.value=c:b.set(a,c),c},aZ=function(a,b,c,d){if("a"===c&&!d)throw TypeError("Private accessor was defined without a getter");if("function"==typeof b?a!==b||!d:!b.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===c?d:"a"===c?d.call(a):d?d.value:b.get(a)};class a${constructor(a,b,c){if(e.add(this),f.set(this,{}),g.set(this,void 0),h.set(this,void 0),aY(this,h,c,"f"),aY(this,g,a,"f"),!b)return;const{name:d}=a;for(const[a,c]of Object.entries(b))a.startsWith(d)&&c&&(aZ(this,f,"f")[a]=c)}get value(){return Object.keys(aZ(this,f,"f")).sort((a,b)=>parseInt(a.split(".").pop()||"0")-parseInt(b.split(".").pop()||"0")).map(a=>aZ(this,f,"f")[a]).join("")}chunk(a,b){let c=aZ(this,e,"m",j).call(this);for(let d of aZ(this,e,"m",i).call(this,{name:aZ(this,g,"f").name,value:a,options:{...aZ(this,g,"f").options,...b}}))c[d.name]=d;return Object.values(c)}clean(){return Object.values(aZ(this,e,"m",j).call(this))}}f=new WeakMap,g=new WeakMap,h=new WeakMap,e=new WeakSet,i=function(a){let b=Math.ceil(a.value.length/3936);if(1===b)return aZ(this,f,"f")[a.name]=a.value,[a];let c=[];for(let d=0;d<b;d++){let b=`${a.name}.${d}`,e=a.value.substr(3936*d,3936);c.push({...a,name:b,value:e}),aZ(this,f,"f")[b]=e}return aZ(this,h,"f").debug("CHUNKING_SESSION_COOKIE",{message:"Session cookie exceeds allowed 4096 bytes.",emptyCookieSize:160,valueSize:a.value.length,chunks:c.map(a=>a.value.length+160)}),c},j=function(){let a={};for(let b in aZ(this,f,"f"))delete aZ(this,f,"f")?.[b],a[b]={name:b,value:"",options:{...aZ(this,g,"f").options,maxAge:0}};return a};class a_ extends Error{constructor(a,b){a instanceof Error?super(void 0,{cause:{err:a,...a.cause,...b}}):"string"==typeof a?(b instanceof Error&&(b={err:b,...b.cause}),super(a,b)):super(void 0,a),this.name=this.constructor.name,this.type=this.constructor.type??"AuthError",this.kind=this.constructor.kind??"error",Error.captureStackTrace?.(this,this.constructor);const c=`https://errors.authjs.dev#${this.type.toLowerCase()}`;this.message+=`${this.message?". ":""}Read more at ${c}`}}class a0 extends a_{}a0.type="MissingSecret";let a1=/^[!#$%&'*+\-.^_`|~0-9A-Za-z]+$/,a2=/^("?)[\u0021\u0023-\u002B\u002D-\u003A\u003C-\u005B\u005D-\u007E]*\1$/,a3=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,a4=/^[\u0020-\u003A\u003D-\u007E]*$/,a5=Object.prototype.toString,a6=((d=function(){}).prototype=Object.create(null),d);function a7(a,b){let c=new a6,d=a.length;if(d<2)return c;let e=b?.decode||bb,f=0;do{let b=a.indexOf("=",f);if(-1===b)break;let g=a.indexOf(";",f),h=-1===g?d:g;if(b>h){f=a.lastIndexOf(";",b-1)+1;continue}let i=a8(a,f,b),j=a9(a,b,i),k=a.slice(i,j);if(void 0===c[k]){let d=a8(a,b+1,h),f=a9(a,h,d),g=e(a.slice(d,f));c[k]=g}f=h+1}while(f<d)return c}function a8(a,b,c){do{let c=a.charCodeAt(b);if(32!==c&&9!==c)return b}while(++b<c)return c}function a9(a,b,c){for(;b>c;){let c=a.charCodeAt(--b);if(32!==c&&9!==c)return b+1}return c}function ba(a,b,c){let d=c?.encode||encodeURIComponent;if(!a1.test(a))throw TypeError(`argument name is invalid: ${a}`);let e=d(b);if(!a2.test(e))throw TypeError(`argument val is invalid: ${b}`);let f=a+"="+e;if(!c)return f;if(void 0!==c.maxAge){if(!Number.isInteger(c.maxAge))throw TypeError(`option maxAge is invalid: ${c.maxAge}`);f+="; Max-Age="+c.maxAge}if(c.domain){if(!a3.test(c.domain))throw TypeError(`option domain is invalid: ${c.domain}`);f+="; Domain="+c.domain}if(c.path){if(!a4.test(c.path))throw TypeError(`option path is invalid: ${c.path}`);f+="; Path="+c.path}if(c.expires){var g;if(g=c.expires,"[object Date]"!==a5.call(g)||!Number.isFinite(c.expires.valueOf()))throw TypeError(`option expires is invalid: ${c.expires}`);f+="; Expires="+c.expires.toUTCString()}if(c.httpOnly&&(f+="; HttpOnly"),c.secure&&(f+="; Secure"),c.partitioned&&(f+="; Partitioned"),c.priority)switch("string"==typeof c.priority?c.priority.toLowerCase():void 0){case"low":f+="; Priority=Low";break;case"medium":f+="; Priority=Medium";break;case"high":f+="; Priority=High";break;default:throw TypeError(`option priority is invalid: ${c.priority}`)}if(c.sameSite)switch("string"==typeof c.sameSite?c.sameSite.toLowerCase():c.sameSite){case!0:case"strict":f+="; SameSite=Strict";break;case"lax":f+="; SameSite=Lax";break;case"none":f+="; SameSite=None";break;default:throw TypeError(`option sameSite is invalid: ${c.sameSite}`)}return f}function bb(a){if(-1===a.indexOf("%"))return a;try{return decodeURIComponent(a)}catch(b){return a}}a.s(["parse",()=>a7,"serialize",()=>ba],63805);let{parse:bc}=a.i(63805),bd="A256CBC-HS512";async function be(a){let{token:b={},secret:c,maxAge:d=2592e3,salt:e}=a,f=Array.isArray(c)?c:[c],g=await bh(bd,f[0],e),h=await aR({kty:"oct",k:aP.encode(g)},`sha${g.byteLength<<3}`);return await new aO(b).setProtectedHeader({alg:"dir",enc:bd,kid:h}).setIssuedAt().setExpirationTime((Date.now()/1e3|0)+d).setJti(crypto.randomUUID()).encrypt(g)}async function bf(a){let{token:b,secret:c,salt:d}=a,e=Array.isArray(c)?c:[c];if(!b)return null;let{payload:f}=await aX(b,async({kid:a,enc:b})=>{for(let c of e){let e=await bh(b,c,d);if(void 0===a||a===await aR({kty:"oct",k:aP.encode(e)},`sha${e.byteLength<<3}`))return e}throw Error("no matching decryption secret")},{clockTolerance:15,keyManagementAlgorithms:["dir"],contentEncryptionAlgorithms:[bd,"A256GCM"]});return f}async function bg(a){var b;let c,{secureCookie:d,cookieName:e=(c=(b=d??!1)?"__Secure-":"",{sessionToken:{name:`${c}authjs.session-token`,options:{httpOnly:!0,sameSite:"lax",path:"/",secure:b}},callbackUrl:{name:`${c}authjs.callback-url`,options:{httpOnly:!0,sameSite:"lax",path:"/",secure:b}},csrfToken:{name:`${b?"__Host-":""}authjs.csrf-token`,options:{httpOnly:!0,sameSite:"lax",path:"/",secure:b}},pkceCodeVerifier:{name:`${c}authjs.pkce.code_verifier`,options:{httpOnly:!0,sameSite:"lax",path:"/",secure:b,maxAge:900}},state:{name:`${c}authjs.state`,options:{httpOnly:!0,sameSite:"lax",path:"/",secure:b,maxAge:900}},nonce:{name:`${c}authjs.nonce`,options:{httpOnly:!0,sameSite:"lax",path:"/",secure:b}},webauthnChallenge:{name:`${c}authjs.challenge`,options:{httpOnly:!0,sameSite:"lax",path:"/",secure:b,maxAge:900}}}).sessionToken.name,decode:f=bf,salt:g=e,secret:h,logger:i=console,raw:j,req:k}=a;if(!k)throw Error("Must pass `req` to JWT getToken()");let l=k.headers instanceof Headers?k.headers:new Headers(k.headers),m=new a$({name:e,options:{secure:d}},bc(l.get("cookie")??""),i).value,n=l.get("authorization");if(m||n?.split(" ")[0]!=="Bearer"||(m=decodeURIComponent(n.split(" ")[1])),!m)return null;if(j)return m;if(!h)throw new a0("Must pass `secret` if not set to JWT getToken()");try{return await f({token:m,secret:h,salt:g})}catch{return null}}async function bh(a,b,c){let d;switch(a){case"A256CBC-HS512":d=64;break;case"A256GCM":d=32;break;default:throw Error("Unsupported JWT Content Encryption Algorithm")}return await n("sha256",b,c,`Auth.js Generated Encryption Key (${c})`,d)}a.s(["decode",()=>bf,"encode",()=>be,"getToken",()=>bg],69581),a.s([],7791)}];

//# sourceMappingURL=node_modules_next-auth_jwt_66e8847b.js.map